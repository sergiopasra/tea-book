
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5.2. Correción de BIAS &#8212; Técnicas Experimentales en Astrofísica</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.3. Correción de Flat Field" href="P2_Fotometria_CCD_03.html" />
    <link rel="prev" title="5.1. Primeros pasos en la reducción de las observaciones" href="P2_Fotometria_CCD_01.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/ucm_logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Técnicas Experimentales en Astrofísica</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   1. Técnicas Experimentales en Astrofísica
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="fotometria.html">
   2. Fotometría
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="fotometria_01.html">
     2.1. Introducción a la Fotometría
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="fotometria_02.html">
     2.2. Instrumentos y métodos
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="fotometria_03.html">
     2.3. Fotometría absoluta
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="fotometria_04.html">
     2.4. Fotometría diferencial
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="fotometria_05.html">
     2.5. Fotometría de objetos extensos
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="fotometria_06.html">
     2.6. Fotometría sintética
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="espectroscopia.html">
   3. Espectroscopía
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="espectroscopia_01.html">
     3.1. Espectroscopía astronómica
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="espectroscopia_02.html">
     3.2. Elección del espectrógrafo y configuración instrumental
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="P1_Introduccion_00.html">
   4. Práctica 1 Procesado de observaciones astronómicas
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="P1_Introduccion_01.html">
     4.1. Introducción
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P1_Introduccion_02.html">
     4.2. Redución de observaciones astronómicas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P1_Introduccion_03.html">
     4.3. Visualización e inspección de imágenes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P1_Introduccion_04.html">
     4.4. Python, cuadernos de Jupyter, astropy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P1_Introduccion_05.html">
     4.5. Cuaderno de observaciones
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P1_Introduccion_06.html">
     4.6. Calibración CCD
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="P2_Fotometria_CCD_00.html">
   5. Práctica 2     Fotometría CCD
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="P2_Fotometria_CCD_01.html">
     5.1. Primeros pasos en la reducción de las observaciones
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     5.2. Correción de BIAS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P2_Fotometria_CCD_03.html">
     5.3. Correción de Flat Field
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P2_Fotometria_CCD_04.html">
     5.4. Combinación de imágenes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P2_Fotometria_CCD_05.html">
     5.5. Alineamiento de imágenes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P2_Fotometria_CCD_06.html">
     5.6. Fotometría de las estrellas estándar
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P2_Fotometria_CCD_07.html">
     5.7. Pasos finales
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="P3_Espectroscopia_Rendija_Larga.html">
   6. P3 Espectroscopía de Rendija Larga
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../notebooks/index-notebooks-ccdproc.html">
   7. TEA Notebooks ccdproc
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_00_Downloading_the_Images.html">
     7.1. ccdproc-00:   Download images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_01_ImageCollection.html">
     7.2. ccdproc-01:   Classify images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_02_Trimming.html">
     7.3. ccdproc-02:   Trimming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_03_Master_BIAS.html">
     7.4. ccdproc-03:   Master BIAS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_04_Substract_BIAS.html">
     7.5. ccdproc-04:   BIAS correction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_05_Master_FLAT.html">
     7.6. ccdproc-05:   Master FLAT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_06_Flatfielding.html">
     7.7. ccdproc-06:   Flatfielding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_07_Combining.html">
     7.8. ccdproc-07: Combining single observations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_08_Star_Photometry.html">
     7.9. ccdproc-08: Photometry of stars
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_08_Star_Photometry.html#local-background-subtraction">
     7.10. Local Background Subtraction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/fotometria_1.html">
     7.11. Ajuste Bouger y término de color
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../notebooks/index-notebooks-examples.html">
   8. TEA Notebooks examples
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/example_01_Read_Display_FITS.html">
     8.1. Example 1:   Reading and displaying an image
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/example_02_Master_DARK.html">
     8.2. Example 2: Master DARK
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/example_03_Master_Flat.html">
     8.3. Example 3: Master FLAT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/example_04_combining_images.html">
     8.4. Example 4: Combining several images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/example_05_register_images.html">
     8.5. Example 5: Registering images with AstroAlign
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/example_06_aperture_photometry.html">
     8.6. Example 6: Aperture photometry with Photutils
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../_sources/docs/P2_Fotometria_CCD_02.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/docs/P2_Fotometria_CCD_02.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/P2_Fotometria_CCD_02.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generacion-del-master-bias">
   5.2.1. Generación del master BIAS
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#correccion-de-bias">
   5.2.2. Corrección de bias
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#corrigiendo-todas-las-imagenes">
   5.2.3. Corrigiendo todas las imágenes
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="correcion-de-bias">
<h1><span class="section-number">5.2. </span>Correción de BIAS<a class="headerlink" href="#correcion-de-bias" title="Permalink to this headline">¶</a></h1>
<div class="section" id="generacion-del-master-bias">
<h2><span class="section-number">5.2.1. </span>Generación del master BIAS<a class="headerlink" href="#generacion-del-master-bias" title="Permalink to this headline">¶</a></h2>
<p>Combinando los BIAS obtendremos un master_BIAS o master_DARK que será el que usemos en la correción de BIAS. Como veremos se consigue una imagen con menor dispersión y en la que desaparecen los píxeles de alta señal correspondientes a la llegada de rayos cósmicos mientras se lee el detector.</p>
<p>Podemos empezar preparando la lista completa de ficheros en nuestro directorio de trabajo. De ella seleccionaremos luego los ficheros de BIAS de esa noche como hemos aprendido antes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="n">directory</span><span class="o">=</span><span class="s1">&#39;/Users/jzamorano/Desktop/NOT_2008/N1/&#39;</span>   <span class="c1"># write here your working directory</span>
<span class="c1"># os.path.join is a platform-independent way to join two directories</span>
<span class="n">globpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">&#39;t_*.fits&#39;</span><span class="p">)</span>      <span class="c1"># already trimmed files names begin with &#39;t_&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">globpath</span><span class="p">)</span>
<span class="c1"># glob searches through directories similar to the Unix shell</span>
<span class="n">filelist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">globpath</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">filelist</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">105</span><span class="p">])</span>    <span class="c1"># printing only from 10 to 20</span>
</pre></div>
</div>
</div>
</div>
<p>Nos preparamos para buscar los ficheros de BIAS de nuestra lista completa de imágenes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ccdproc</span> <span class="kn">import</span> <span class="n">ImageFileCollection</span>
<span class="kn">from</span> <span class="nn">ccdproc.utils.sample_directory</span> <span class="kn">import</span> <span class="n">sample_directory_with_files</span>
<span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;imagetyp&#39;</span><span class="p">,</span><span class="s1">&#39;OBJECT&#39;</span> <span class="p">,</span> <span class="s1">&#39;EXPTIME&#39;</span> <span class="p">,</span> <span class="s1">&#39;ALFLTID&#39;</span> <span class="p">,</span> <span class="s1">&#39;FAFLTID&#39;</span> <span class="p">,</span> <span class="s1">&#39;FBFLTID&#39;</span><span class="p">]</span>
<span class="n">ic1</span> <span class="o">=</span> <span class="n">ImageFileCollection</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="n">keys</span><span class="p">)</span> <span class="c1"># only keep track of keys</span>
<span class="n">ic1</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">colnames</span>
<span class="nb">print</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Seleccionamos los que tienen ‘BIAS’ en el descriptor <code class="docutils literal notranslate"><span class="pre">imagetyp</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">matches</span> <span class="o">=</span> <span class="p">(</span><span class="n">ic1</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;imagetyp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;BIAS&#39;</span><span class="p">)</span> 
<span class="n">my_bias_files</span> <span class="o">=</span> <span class="n">ic1</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="n">matches</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_bias_files</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Leemos los ficheros a objetos CCDData ya que queremos usar <code class="docutils literal notranslate"><span class="pre">ccdproc</span></code>para combinarlos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image_bias</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">my_bias_files</span><span class="p">:</span>
    <span class="n">image_bias</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="n">file</span><span class="p">))</span> <span class="c1">#, unit=&quot;adu&quot;))</span>
</pre></div>
</div>
</div>
</div>
<p>La recomendación es visualizarlos con DS9 para comprobar que son todos útiles y que no hay alguno con dimensiones distintas o algún otro problema. Podemos hacer un poco de estadística.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filename          Object        exp Mean std min  max&#39;</span><span class="p">)</span>
<span class="n">exposure</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">my_bias_files</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">],</span> 
          <span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">],</span> 
          <span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">],</span> 
          <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span> 
          <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span> 
          <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> 
          <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<pre>
Filename          Object        exp Mean std min  max
t_ALrd120001.fits Bias afternoon 0.0 353 7 311 10680
t_ALrd120002.fits Bias afternoon 0.0 355 8 313 10558
t_ALrd120003.fits Bias afternoon 0.0 357 8 314 8746
t_ALrd120004.fits Bias afternoon 0.0 358 5 312 5407
t_ALrd120005.fits Bias afternoon 0.0 358 7 313 8782
t_ALrd120006.fits Bias afternoon 0.0 358 5 317 4349
t_ALrd120007.fits Bias afternoon 0.0 358 4 317 1631
t_ALrd120008.fits Bias afternoon 0.0 358 10 317 10974
t_ALrd120009.fits Bias afternoon 0.0 358 4 316 1518
t_ALrd120010.fits Bias afternoon 0.0 358 6 319 7516
</pre>
<p>Y también preparar unos histogramas para comprobar que son similares entre sí.<br />
Para hacer el histograma se necesita</p>
<ul class="simple">
<li><p>usar los datos del objeto <code class="docutils literal notranslate"><span class="pre">CCDData</span></code>  image_bias[i].data</p></li>
<li><p>colapsar el array resultante a una dimensión con <code class="docutils literal notranslate"><span class="pre">flatten()</span></code>  image_bias[i].data.flatten()</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>astropy dispone de una rutina de histograma más completa si se desea:  <a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.visualization.hist.html#astropy.visualization.hist">astropy hist</a>.<br />
Esa rutina de histograma forma parte de <a class="reference external" href="https://docs.astropy.org/en/stable/visualization/index.html#module-astropy.visualization">astropy Data Visualization</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">330</span><span class="p">,</span> <span class="mi">380</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span> <span class="c1">#len(my_bias_files)):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">340</span><span class="p">,</span><span class="mi">360</span><span class="p">,</span><span class="mi">380</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;BIAS &#39;</span><span class="o">+</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">:</span><span class="mi">12</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">label_outer</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">330</span><span class="p">,</span><span class="mi">380</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span> <span class="c1">#len(my_bias_files)):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">340</span><span class="p">,</span><span class="mi">360</span><span class="p">,</span><span class="mi">380</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;BIAS &#39;</span><span class="o">+</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">:</span><span class="mi">12</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">label_outer</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">330</span><span class="p">,</span><span class="mi">380</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Hemos elegido representar entre valores cercanos al valor medio que encontramos antes</p>
<div class="figure align-default" id="bias-1-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_1.png"><img alt="../_images/p2_04_bias_1.png" src="../_images/p2_04_bias_1.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.6 </span><span class="caption-text">Histograma de las imágenes de BIAS correspondientes a la noche primera.</span><a class="headerlink" href="#bias-1-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="bias-2-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_2.png"><img alt="../_images/p2_04_bias_2.png" src="../_images/p2_04_bias_2.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.7 </span><span class="caption-text">Representación de las imágenes de BIAS usando los mismos cortes. Se aprecian pequeñas diferencias.</span><a class="headerlink" href="#bias-2-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="bias-3-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_3.png"><img alt="../_images/p2_04_bias_3.png" src="../_images/p2_04_bias_3.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.8 </span><span class="caption-text">Imagen del último BIAS de la serie de 10 y detalle del mismo en una región con impactos aparentes de rayos cósmicos.</span><a class="headerlink" href="#bias-3-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Para combinar las imágenes de BIAS usaremos algunos paquetes de astropy</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Some astropy packages </span>
<span class="kn">import</span> <span class="nn">ccdproc</span>
<span class="kn">from</span> <span class="nn">ccdproc</span> <span class="kn">import</span> <span class="n">CCDData</span><span class="p">,</span> <span class="n">Combiner</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">astropy.stats</span> <span class="kn">import</span> <span class="n">sigma_clip</span><span class="p">,</span> <span class="n">mad_std</span>
<span class="kn">from</span> <span class="nn">astropy.stats</span> <span class="kn">import</span> <span class="n">sigma_clipped_stats</span>
</pre></div>
</div>
</div>
</div>
<p>Para combinar imágenes <code class="docutils literal notranslate"><span class="pre">astropy</span></code> dispone de <code class="docutils literal notranslate"><span class="pre">Combiner</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Combiner is a class for combining CCDData objects.</span>
<span class="c1"># https://ccdproc.readthedocs.io/en/latest/api/ccdproc.Combiner.html</span>
<span class="c1"># The Combiner class is used to combine together CCDData objects </span>
<span class="c1"># including the method for combining the data, rejecting outlying data, </span>
<span class="c1"># and weighting used for combining frames.</span>

<span class="n">combiner</span> <span class="o">=</span> <span class="n">Combiner</span><span class="p">(</span><span class="n">image_bias</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Antes de combinar podemos rechazar los valores altos que aparecen en los píxeles impactados por rayos cósmicos.<br />
El master_dark se puede ahora crear con la combinación de nuestro gusto. Para 10 ficheros de BIAS las diferencias van a ser mínimas entre <code class="docutils literal notranslate"><span class="pre">median_combine</span></code> o <code class="docutils literal notranslate"><span class="pre">mean_combine</span></code>. Puede leerse sobre este tema en: <a class="reference external" href="https://mwcraig.github.io/ccd-as-book/01-06-Image-combination.html">CCD data reduction guide  Image combination</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># clipping all values over 800 to remove cosmic rays hits </span>
<span class="n">combiner</span><span class="o">.</span><span class="n">minmax_clipping</span><span class="p">(</span><span class="n">min_clip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_clip</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
<span class="c1"># median combine </span>
<span class="n">master_dark</span> <span class="o">=</span> <span class="n">combiner</span><span class="o">.</span><span class="n">median_combine</span><span class="p">()</span>
<span class="c1"># median filter  </span>
<span class="n">master_dark_filtered</span> <span class="o">=</span> <span class="n">ccdproc</span><span class="o">.</span><span class="n">median_filter</span><span class="p">(</span><span class="n">master_dark</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="bias-4-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_4.png"><img alt="../_images/p2_04_bias_4.png" src="../_images/p2_04_bias_4.png" style="width: 800px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.9 </span><span class="caption-text">Detalles de y estadística (media y desviación estándar) de una imagen individual de BIAS y la combinación de mediana. La última imagen es el resultado de aplicar un filtro de mediana a éste último dark. La región amarilla presenta una estadística con mayor desviación debido a los impactos de rayos cósmicos pero en el master_dark este problema se arregla. Nótese que los píxeles de valor alto han desaparecido.</span><a class="headerlink" href="#bias-4-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Copiamos la cabecera de uno de los BIAS y le añadimos información del procesado hasta llegar al master_dark. usamos como FILENAME ‘N1_master_dark’ que es un nombre más descriptivo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copy primary header from single dark file and copy into master_dark header</span>
<span class="n">master_dark</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">image_bias</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace FILENAME keyword and add information</span>
<span class="n">master_dark</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;super DARK combining &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_bias</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; BIAS images&#39;</span>
<span class="n">master_dark</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>  <span class="o">=</span>  <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())[</span><span class="mi">0</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; astropy median combine&#39;</span>
<span class="n">master_dark</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;BIAS images from &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">])</span>
<span class="n">master_dark</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N1_master_dark&#39;</span> 
</pre></div>
</div>
</div>
</div>
<p>A continuación escribimos esta imagen como fichero FITS en el directorio de trabajo como ‘zero_N1.fits’</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">master_dark</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="s1">&#39;zero_N1.fits&#39;</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="bias-5-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_5.png"><img alt="../_images/p2_04_bias_5.png" src="../_images/p2_04_bias_5.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.10 </span><span class="caption-text">Estas tres líneas aparecen en el final de la cabecera del master_dark informando de cómo se ha preparado esta imagen. Se conservan las dos primeras líneas de HISTORY donde se apuntaba el recorte (‘trimming’) que habían sufrido anteriormente.</span><a class="headerlink" href="#bias-5-fig" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="correccion-de-bias">
<h2><span class="section-number">5.2.2. </span>Corrección de bias<a class="headerlink" href="#correccion-de-bias" title="Permalink to this headline">¶</a></h2>
<p>En este paso utilizaremos el master_DARK (o master_BIAS) para corregir todas las imágenes de este nivel de BIAS. No es necesario seleccionar por filtro empleado en este caso porque el nivel es independiente de la cantidad y tipo de luz que llegue al chip.</p>
<p>Si hemos seguido los pasos anteriores nuestro master DARK se llama ‘zero_N1.fits’ y se encuentra en nuestro directorio de trabajo. En este directorio están también las imágenes recortadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># reading master_bias from &#39;zero_N1.fits&#39;</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;zero_N1.fits&#39;</span>
<span class="n">master_bias</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Haremos una corrección de BIAS en dos imágenes como ejemplo para ver que el comando ccdproc_subtract_bias que usaremos luego es una simple resta de imágenes. Una de ellas es una observación de nuestro proyecto y la otra una imagen de calibración, uno de los BIAS individuales que usamos para construir el maaster BIAS.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">science</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filelist</span><span class="p">[</span><span class="mi">102</span><span class="p">])</span>    <span class="c1"># file with a science observation</span>
<span class="n">onebias</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filelist</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>      <span class="c1"># file with a single BIAS frame</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Statistics of the example images</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filename          Object            exp  Mean std min  max&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">science</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">],</span> <span class="n">science</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">],</span> <span class="n">science</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">],</span> 
          <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">science</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">science</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">science</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">science</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bias</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">],</span> <span class="n">onebias</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">],</span> <span class="n">onebias</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">],</span> 
          <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">onebias</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">onebias</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">onebias</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">onebias</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<pre>
Filename          Object            exp  Mean std min  max
t_ALrd120103.fits GC4496A R 3x300s 300.0 6431 456 367 65535
t_ALrd120010.fits Bias afternoon 0.0 358 6 319 7516
</pre>
<p>La imagen de ciencia es la primera observación de una serie de tres observaciones de 300s de exposición de NGC4496A con el filtro R. Nótese que el observador puso ‘GC4496A’ en lugar de ‘NGC4496A’. El valor máximo es de 65535 que resulta ser el número más alto que se puede reperesentar con números binarios de 16-bits (unsigned) y por lo tanto indica que hay algún píxel completamente saturado.  ( 65535 =  2^16 -1 )</p>
<div class="figure align-default" id="bias-6-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_6.png"><img alt="../_images/p2_04_bias_6.png" src="../_images/p2_04_bias_6.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.11 </span><span class="caption-text">Imágenes de prueba a las que vamos a restar el master BIAS. Los recuadros muestran el valor medio y la desviación estándar.</span><a class="headerlink" href="#bias-6-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Corrección de BIAS usando numpy subtract</span>
<span class="n">onebias_minus_bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">onebias</span><span class="p">,</span><span class="n">master_bias</span><span class="p">)</span>
<span class="n">science_minus_bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">science</span><span class="p">,</span><span class="n">master_bias</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="bias-7-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_7.png"><img alt="../_images/p2_04_bias_7.png" src="../_images/p2_04_bias_7.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.12 </span><span class="caption-text">Las imágenes de prueba a las que hemos restado el master BIAS. Los recuadros muestran el valor medio y la desviación estándar. Como esperábamos la señal de un BIAS al que restamos un master BIAS se queda en cero y la desviación típica no cambia. En el caso de la imagen de ciencia tenemos el nivel reducido en unas 358 cuentas (el valor medio del master BIAS).</span><a class="headerlink" href="#bias-7-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Corregir con el comando de ccdproc es muy sencillo y produce el mismo resultado.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Corrección de BIAS usando numpy subtract</span>
<span class="n">bias_subtracted_onebias</span> <span class="o">=</span> <span class="n">ccdproc</span><span class="o">.</span><span class="n">subtract_bias</span><span class="p">(</span><span class="n">onebias</span><span class="p">,</span> <span class="n">master_bias</span><span class="p">)</span>
<span class="n">bias_subtracted_science</span> <span class="o">=</span> <span class="n">ccdproc</span><span class="o">.</span><span class="n">subtract_bias</span><span class="p">(</span><span class="n">science</span><span class="p">,</span> <span class="n">master_bias</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="bias-8-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_8.png"><img alt="../_images/p2_04_bias_8.png" src="../_images/p2_04_bias_8.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.13 </span><span class="caption-text">Las imágenes de prueba a las que vamos hemos restado el master BIAS usando ccdproc.subtract_bias). El resultado es idéntico.</span><a class="headerlink" href="#bias-8-fig" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="corrigiendo-todas-las-imagenes">
<h2><span class="section-number">5.2.3. </span>Corrigiendo todas las imágenes<a class="headerlink" href="#corrigiendo-todas-las-imagenes" title="Permalink to this headline">¶</a></h2>
<p>Este sencillo paso que haremos a continuación falla al llegar al fichero ‘t_ALrd120063.fits’ ya que ésta es una imagen de menor tamaño. Esta observación es un enfoque del telescopio y no tiene utilidad científica. Por eso es conveniente mirar el cuaderno de observaciones. Por lo tanto la borramos.</p>
<pre>
$ rm t_ALrd120063.fits
</pre>
<p>ahora simplemente recorremos toda la lista de imágenes y para cada una de ellas efectuamos la substracción de BIAS, le cambiamos el nombre añadiendo una z (de ‘zero corrected’) y añadimos información con descriptores HISTORY.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filelist</span><span class="p">)):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filelist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1">#, unit=&quot;adu&quot;)</span>
    <span class="n">z_image</span> <span class="o">=</span> <span class="n">ccdproc</span><span class="o">.</span><span class="n">subtract_bias</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">master_bias</span><span class="p">)</span>
    <span class="n">name_of_file</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">])</span>
    <span class="n">z_image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">name_of_file</span>
    <span class="n">z_image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())[</span><span class="mi">0</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; astropy ccdproc substract_bias&#39;</span>
    <span class="n">z_image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s1">&#39;using NOT2008/N1/zero_N1.fits master BIAS&#39;</span> 
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;writting &#39;</span><span class="o">+</span><span class="n">name_of_file</span><span class="o">+</span> <span class="s1">&#39; in &#39;</span><span class="o">+</span><span class="n">directory</span><span class="p">)</span>
    <span class="n">z_image</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="n">name_of_file</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Si todo ha ido bien tendremos en el directorio de trabajo imágenes con nombre ‘zt_ALrd120062.fits’ por ejemplo y que en cuya cabecera FITS se puede leer la información de su procesado.</p>
<div class="figure align-default" id="bias-9-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_9.png"><img alt="../_images/p2_04_bias_9.png" src="../_images/p2_04_bias_9.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5.14 </span><span class="caption-text">Estas líneas aparecen en el final de la cabecera de las imágenes corregidas de BIAS informando de cómo se ha procesado esta imagen. Se conservan las dos primeras líneas de HISTORY donde se apuntaba el recorte (‘trimming’) que habían sufrido anteriormente.</span><a class="headerlink" href="#bias-9-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Los ficheros se han creado en el mismo directorio del que leimos las imágenes. La recomendación es dejarlos ahí y crear un subdirectorio para meter las imágenes recortadas (primer paso). De esta forma nuestro directorio de trabajo sigue siendo el mismo y las imágenes originales y recortadas siguen a nuestra disposición por si nos equivocamos en alguno de los pasos. Tendríamos entonces</p>
<pre>
NOT_2008/N1                directorio de trabajo con los t_AL*.fits ficheros recortados
NOT_2008/N1/0_originales   donde mantenemos los ficheros antes de procesado
NOT_2008/N1/1_recortados   donde almacenaremos el resultado del primer paso 
                           $> mkdir 1_recortados
                           $> mv t_AL*.fits 1_recortados/.
</pre>
<p>Si hacemos un listado nuestro directorio de trabajo tendrá este aspecto:</p>
<pre>
N1 jzamorano$ ls
0_originales       zt_ALrd120011.fits zt_ALrd120024.fits zt_ALrd120037.fits zt_ALrd120050.fits
1_recortados       zt_ALrd120012.fits zt_ALrd120025.fits zt_ALrd120038.fits zt_ALrd120051.fits
zero_N1.fits       zt_ALrd120013.fits zt_ALrd120026.fits zt_ALrd120039.fits zt_ALrd120052.fits
zt_ALrd120001.fits zt_ALrd120014.fits zt_ALrd120027.fits zt_ALrd120040.fits zt_ALrd120053.fits
zt_ALrd120002.fits zt_ALrd120015.fits zt_ALrd120028.fits zt_ALrd120041.fits zt_ALrd120054.fits
zt_ALrd120003.fits zt_ALrd120016.fits zt_ALrd120029.fits zt_ALrd120042.fits zt_ALrd120055.fits
zt_ALrd120004.fits zt_ALrd120017.fits zt_ALrd120030.fits zt_ALrd120043.fits zt_ALrd120056.fits
zt_ALrd120005.fits zt_ALrd120018.fits zt_ALrd120031.fits zt_ALrd120044.fits zt_ALrd120057.fits
zt_ALrd120006.fits zt_ALrd120019.fits zt_ALrd120032.fits zt_ALrd120045.fits zt_ALrd120058.fits
zt_ALrd120007.fits zt_ALrd120020.fits zt_ALrd120033.fits zt_ALrd120046.fits zt_ALrd120059.fits
...
</pre></div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="P2_Fotometria_CCD_01.html" title="previous page"><span class="section-number">5.1. </span>Primeros pasos en la reducción de las observaciones</a>
    <a class='right-next' id="next-link" href="P2_Fotometria_CCD_03.html" title="next page"><span class="section-number">5.3. </span>Correción de Flat Field</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By J.Zamorano, N. Cardiel, S. Pascual and J. Gallego<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>
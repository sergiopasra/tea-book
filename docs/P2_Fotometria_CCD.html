
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>P2 Fotometría CCD &#8212; Técnicas Experimentales en Astrofísica</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/ucm_logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Técnicas Experimentales en Astrofísica</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   1. Técnicas Experimentales en Astrofísica
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="fotometria.html">
   2. Fotometría
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="fotometria_01.html">
     2.1. Introducción a la Fotometría
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="fotometria_02.html">
     2.2. Instrumentos y métodos
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="fotometria_03.html">
     2.3. Fotometría absoluta
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="fotometria_04.html">
     2.4. Fotometría diferencial
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="fotometria_05.html">
     2.5. Fotometría de objetos extensos
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="fotometria_06.html">
     2.6. Fotometría sintética
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="espectroscopia.html">
   3. Espectroscopía
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="espectroscopia_01.html">
     3.1. Espectroscopía astronómica
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="espectroscopia_02.html">
     3.2. Elección del espectrógrafo y configuración instrumental
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="P1_Introduccion_00.html">
   4. Práctica 1 Procesado de observaciones astronómicas
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="P1_Introduccion_01.html">
     4.1. Introducción
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P1_Introduccion_02.html">
     4.2. Redución de observaciones astronómicas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P1_Introduccion_03.html">
     4.3. Visualización e inspección de imágenes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P1_Introduccion_04.html">
     4.4. Python, cuadernos de Jupyter, astropy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P1_Introduccion_05.html">
     4.5. Cuaderno de observaciones
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P1_Introduccion_06.html">
     4.6. Calibración CCD
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="P2_Fotometria_CCD_00.html">
   5. Práctica 2     Fotometría CCD
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="P2_Fotometria_CCD_01.html">
     5.1. Primeros pasos en la reducción de las observaciones
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P2_Fotometria_CCD_02.html">
     5.2. Correción de BIAS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P2_Fotometria_CCD_03.html">
     5.3. Correción de Flat Field
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P2_Fotometria_CCD_04.html">
     5.4. Combinación de imágenes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P2_Fotometria_CCD_05.html">
     5.5. Alineamiento de imágenes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P2_Fotometria_CCD_06.html">
     5.6. Fotometría de las estrellas estándar
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="P2_Fotometria_CCD_07.html">
     5.7. Pasos finales
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="P3_Espectroscopia_Rendija_Larga.html">
   6. P3 Espectroscopía de Rendija Larga
  </a>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../notebooks/index-notebooks-ccdproc.html">
   7. TEA Notebooks ccdproc
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_00_Downloading_the_Images.html">
     7.1. ccdproc-00:   Download images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_01_ImageCollection.html">
     7.2. ccdproc-01:   Classify images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_02_Trimming.html">
     7.3. ccdproc-02:   Trimming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_03_Master_BIAS.html">
     7.4. ccdproc-03:   Master BIAS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_04_Substract_BIAS.html">
     7.5. ccdproc-04:   BIAS correction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_05_Master_FLAT.html">
     7.6. ccdproc-05:   Master FLAT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_06_Flatfielding.html">
     7.7. ccdproc-06:   Flatfielding
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_07_Combining.html">
     7.8. ccdproc-07: Combining single observations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_08_Star_Photometry.html">
     7.9. ccdproc-08: Photometry of stars
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/ccdproc_08_Star_Photometry.html#local-background-subtraction">
     7.10. Local Background Subtraction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/fotometria_1.html">
     7.11. Ajuste Bouger y término de color
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
 <li class="toctree-l1 collapsible-parent">
  <a class="reference internal" href="../notebooks/index-notebooks-examples.html">
   8. TEA Notebooks examples
  </a>
  <ul class="collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/example_01_Read_Display_FITS.html">
     8.1. Example 1:   Reading and displaying an image
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/example_02_Master_DARK.html">
     8.2. Example 2: Master DARK
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/example_03_Master_Flat.html">
     8.3. Example 3: Master FLAT
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/example_04_combining_images.html">
     8.4. Example 4: Combining several images
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/example_05_register_images.html">
     8.5. Example 5: Registering images with AstroAlign
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../notebooks/example_06_aperture_photometry.html">
     8.6. Example 6: Aperture photometry with Photutils
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="../_sources/docs/P2_Fotometria_CCD.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/docs/P2_Fotometria_CCD.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/P2_Fotometria_CCD.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#campana-de-observacion">
   Campaña de observación
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#informacion-previa">
     Información previa
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#descarga-de-los-ficheros">
     Descarga de los ficheros
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inspeccion-de-las-imagenes">
     Inspección de las imágenes
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reduccion-de-las-observaciones">
   Reducción de las observaciones.
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creacion-de-las-listas-de-imagenes">
     Creación de las listas de imágenes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sustraccion-del-overscan">
     Sustracción del overscan
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recorte-de-las-imagenes">
     Recorte de las imágenes
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#aprendiendo-a-recortar">
       Aprendiendo a recortar
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#recortar-con-python">
         recortar con python
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#recortar-con-ccdproc-trim-image">
         recortar con ccdproc trim_image
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#recortando-nuestras-imagenes">
       Recortando nuestras imágenes
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generacion-del-master-bias">
     Generación del master BIAS
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correccion-de-bias">
     Corrección de bias
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#corrigiendo-todas-las-imagenes">
       Corrigiendo todas las imágenes
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generacion-de-un-master-flat-field-por-filtro">
     Generación de un máster flat field por filtro
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#corrigiendo-de-variacion-espacial-de-sensibilidad">
     Corrigiendo de variación espacial de sensibilidad
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pre-file-br-flat-n1-78-fits-zt-alrd120021-fits-zt-alrd120023-fits-zt-alrd120024-fits">
   <pre>
file<br/>
flat_N1_78.fits
zt_ALrd120021.fits
zt_ALrd120023.fits
zt_ALrd120024.fits</pre>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pre-file">
   <pre>
file</pre>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#procesado-de-las-imagenes-de-estandares-de-flujo-y-cientificas">
     Procesado de las imágenes de estándares de flujo y científicas
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#eliminacion-de-rayos-cosmicos">
     Eliminación de rayos cósmicos
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calibracion-astrometrica">
     Calibración astrométrica
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calibracion-fotometrica">
     Calibración fotométrica
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="p2-fotometria-ccd">
<h1>P2 Fotometría CCD<a class="headerlink" href="#p2-fotometria-ccd" title="Permalink to this headline">¶</a></h1>
<div class="section" id="campana-de-observacion">
<h2>Campaña de observación<a class="headerlink" href="#campana-de-observacion" title="Permalink to this headline">¶</a></h2>
<p>Se realiza la reducción de una campaña de observación de objetos extensos realizada
con el Nordic Optical Telescope (La Palma) en abril de 2008. Se empleó el espectrógrafo <a class="reference external" href="http://www.not.iac.es/instruments/alfosc/">Alhambra Faint Object Spectrograph and Camera</a>. En particular, se trata del proyecto Calibrating the [OII]158 micron line as a star formation rate tracer (PI: A. Gil de Paz; Observadores: Pablo G. Pérez González &amp; Jaime Zamorano). Se muestran a continuación, con cierto detalle, los pasos necesarios para su reducción.</p>
<div class="figure align-default" id="alfosc-fig">
<a class="reference internal image-reference" href="../_images/p2_01_ALFOSC_plan.png"><img alt="../_images/p2_01_ALFOSC_plan.png" src="../_images/p2_01_ALFOSC_plan.png" style="height: 400px;" /></a>
<p class="caption"><span class="caption-text">Esquema de ALFOSC que es el espectrógrafo de objetos débiles usado ene sta campaña de observación.</span><a class="headerlink" href="#alfosc-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="informacion-previa">
<h3>Información previa<a class="headerlink" href="#informacion-previa" title="Permalink to this headline">¶</a></h3>
<p>Es importante abrir el cuaderno de observación (logbook_NOT_2008.pdf) donde se encuentra la información necesaria sobre esta campaña de observación. En particular la secuencia de las observaciones. Se indica, por ejemplo, que los ficheros que se fueron grabando en un directorio un ordenador del NOT  /data/alfosc/ con nombres numerados consecutivamente. El primero sería entonces ALrd12001.fits donde Al viene de ALFOSC, r es el año, d el mes (abril), 12 el día y 001 el número de orden.</p>
<p>Los filtros empleados son</p>
<pre>
FILTROS
#74 BESSEL B
#75 BESSEL V
#76 BESSEL R
#49 660.7 nm estrecho 661.5
#78 658.0 nm          658.4
</pre>
</div>
<div class="section" id="descarga-de-los-ficheros">
<h3>Descarga de los ficheros<a class="headerlink" href="#descarga-de-los-ficheros" title="Permalink to this headline">¶</a></h3>
<p>Los ficheros de las observaciones se encuentran disponibles en un ftp anónimo, y el cuaderno de observación (logbook), ubicado en el Campus Virtual de la asignatura. Las imágenes originales en el ftp de astrax /pub/users/jaz/NOT_2008_04_12-14/2008-04-14 tienen nombres como ALrd140129.fits y son ficheros FITS con extensión. Para facilitar la reducción en los directorios /pub/users/jaz/NOT_2008_04_12-14/N1 (primera noche) y /N2 (segunda noche) hemos renombrado los ficheros retirando algunos caracteres AL12146.fits y convertido a FITS sin extensión. Las observaciones también se pueden descargar de <a class="reference external" href="http://guaix.fis.ucm.es/~jaz/master_TEA/observaciones_NOT_2008/N1/">http://guaix.fis.ucm.es/~jaz/master_TEA/observaciones_NOT_2008/N1/</a></p>
<p>Es aconsejable tener un árbol de directorios que permita en todo momento saber donde se encuentran los ficheros en sus dirferentes fases de porcesado. Como veremos conviene nombrar a los ficheros de manera que identifiquen su contenido y sean fácil recordar sus nombres.</p>
<p>Recordemos que los comandos usuales de Linux para navegar por los directorios y explorar su contenido  son:</p>
<pre>
$> cd ..		# baja al directorio inferior
$> cd -			# vuelve al directorio anterior
$> cd 			# nos situa de nuevo en /home/alumnos/
$> pwd			# nos informa del directorio actual
$> ls			# listado del contenido del directorio
$> ls -la		# listado con más información
$> ls -lah		# idem con tamaños de fichero  en kb y Mb
$> ls -lart		# reverse time listado no alfabético sino temporal
				# sirve para ver los últimos ficheros creados
$> more filename 	# muestra el contenido del fichero filename
$> head filename	# muestra solo las primeras líneas de filename
$> tail filename	# muestra solo las últimas líneas de filename
</pre>
<p>Otros comandos de Linux que vamos a usar son</p>
<pre>
$> cp file1 file2	# crea una copia del fichero file1 de nombre file2
$> mv file2 file_2	# renombra file2 a file_2
</pre>
</div>
<div class="section" id="inspeccion-de-las-imagenes">
<h3>Inspección de las imágenes<a class="headerlink" href="#inspeccion-de-las-imagenes" title="Permalink to this headline">¶</a></h3>
<p>Antes de empezar la reducción propiamente dicha vamos explorar las cabeceras FITS de los ficheros y a visualizar alguna imagen. Para ello lo ideal es abrir DS9. La terminal gráfica DS9 permite cambiar la forma de visualización (tablas de color, zoom etc) con los menús desplegables y botones. Simplemente moviendo el cursor podemos saber en qué zona de la imagen estamos y su valor en cuentas. Hay que jugar un poco con los controles para ganar experiencia.</p>
<div class="figure align-default" id="ds9-1-fig">
<a class="reference internal image-reference" href="../_images/p2_02_ds9_1.png"><img alt="../_images/p2_02_ds9_1.png" src="../_images/p2_02_ds9_1.png" style="height: 400px;" /></a>
<p class="caption"><span class="caption-text">Imagen AL12102.fits cargada en DS9. Se ha hecho <code class="docutils literal notranslate"><span class="pre">zoom</span></code> para mostar la imagen completa y se ha modificado la forma de la ventana de DS9 para hacerla más cuadrada.</span><a class="headerlink" href="#ds9-1-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="ds9-2-fig">
<a class="reference internal image-reference" href="../_images/p2_02_ds9_2.png"><img alt="../_images/p2_02_ds9_2.png" src="../_images/p2_02_ds9_2.png" style="height: 400px;" /></a>
<p class="caption"><span class="caption-text">Se ha marcado en verde una región que contiene la parte con señal de la imagen. Después recortaremos los que sobre. Para ello hemos usado <code class="docutils literal notranslate"><span class="pre">region</span></code> y hemos escogido que fuera tipo cuadrado (box). Luego hemos modificado su tamaño y posición.</span><a class="headerlink" href="#ds9-2-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="ds9-3-fig">
<a class="reference internal image-reference" href="../_images/p2_02_ds9_3.png"><img alt="../_images/p2_02_ds9_3.png" src="../_images/p2_02_ds9_3.png" style="height: 400px;" /></a>
<p class="caption"><span class="caption-text">En el menu desplegable de  <code class="docutils literal notranslate"><span class="pre">file</span></code> de DS9 se ha seleccionado <code class="docutils literal notranslate"><span class="pre">display</span> <span class="pre">header</span></code>. Se muestra la primera parte de la cabecera FITS.</span><a class="headerlink" href="#ds9-3-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Es importante inspeccionar la cabecera porque cada telescopio/instrumento escribe las cabeceras FITS de sus observaciones de forma un poco particular. En particular para los <code class="docutils literal notranslate"><span class="pre">keyword</span></code> de  <a class="reference external" href="http://www.not.iac.es/instruments/alfosc/">ALFOSC at NOT</a> se escribe <code class="docutils literal notranslate"><span class="pre">ALFLTID</span></code> and  <code class="docutils literal notranslate"><span class="pre">FBFLTID</span></code> en las cabeceras en lugar de <code class="docutils literal notranslate"><span class="pre">FILTER</span></code> que suele ser el nombre de este keyword. La razón es que ALFOSC (espectrógrafo de objetos débiles) está diseñado de forma que posee dos ruedas de filtros (FASU) filterwheel A y filterwheel B. Los filtros se colocan en una u otra rueda dependiendo de su tamaño y/o anchura de la banda.  Más información en <a class="reference external" href="http://www.not.iac.es/instruments/filters/">NOT filters</a>.</p>
<p>Los extremos están entre (3,52) en el lado izquierdo y (2101,2198) en el derecho. La información se suele encontrar en la cabecera FITS como biassec y trimsec. Esta última no aparece en la cabecera en este caso. Finalmente tomaremos</p>
<pre>
BIASSEC= [3:52,1:2052]       TRIMSEC= [54:2100,1:2052]
</pre>
<p>donde los números en los corchetes indican desde la columna 3 a la 52 es región de overscan que puede usarse para medida de BIAS y que desde 54 a 2100 (para todas las filas de la imagen) tenemos imagen útil. En realidad arriba y abajo (tenemos zonas sin señal debido en este caso a que el filtro era un poco más pequeño y reducía el campo de visión (FoV).</p>
<div class="figure align-default" id="ds9-4-fig">
<a class="reference internal image-reference" href="../_images/p2_02_ds9_4.png"><img alt="../_images/p2_02_ds9_4.png" src="../_images/p2_02_ds9_4.png" style="height: 400px;" /></a>
<p class="caption"><span class="caption-text">Detalle en la esquina inferior izquierda de DS9 mostrando el cursor justo en la frontera entre la parte oscura y la región con imagen. Se ha usado el <code class="docutils literal notranslate"><span class="pre">zoom</span></code>. Los números arriba muestran la posición del cursor.</span><a class="headerlink" href="#ds9-4-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="ds9-5-fig">
<a class="reference internal image-reference" href="../_images/p2_02_ds9_5.png"><img alt="../_images/p2_02_ds9_5.png" src="../_images/p2_02_ds9_5.png" style="height: 400px;" /></a>
<p class="caption"><span class="caption-text">Detalle en la esquina inferior derecha de DS9 mostrando el cursor justo en la frontera entre la parte oscura y la región con imagen.</span><a class="headerlink" href="#ds9-5-fig" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="reduccion-de-las-observaciones">
<h2>Reducción de las observaciones.<a class="headerlink" href="#reduccion-de-las-observaciones" title="Permalink to this headline">¶</a></h2>
<p>Reduciremos a continuación la primera noche de observación. Los pasos seguidos son idénticos para la segunda noche pero se prefiere construir los master BIAS y master FLATs para cada noche y usarlos para las observaciones correspondientes.</p>
<p>Estamos siguiendo en gran parte los pasos descritos en <a class="reference external" href="https://mwcraig.github.io/ccd-as-book/00-00-Preface.html">CCD Data Reduction Guide</a> una guía muy completa escrita por Matt Craig and Lauren Chambers y editada por Lauren Glattly. En esa guía se dan detalles muy interesantes sobre cómo es una imagen CCD fabricando imágenes artificiales y procesándolas de diferentes maneras.</p>
<p>Se han escrito cuadernos de Jupyter para cada paso y se muestran sólo partes de los mismos en este documento. Se usa en preferencia <a class="reference external" href="https://ccdproc.readthedocs.io/en/latest/">ccdproc</a>.  “Ccdproc is is an Astropy affiliated package for basic data reductions of CCD images. It provides the essential tools for processing of CCD images in a framework that provides error propagation and bad pixel tracking throughout the reduction process.” (© Copyright 2020, Steve Crawford, Matt Craig, and Michael Seifert.)</p>
<div class="section" id="creacion-de-las-listas-de-imagenes">
<h3>Creación de las listas de imágenes<a class="headerlink" href="#creacion-de-las-listas-de-imagenes" title="Permalink to this headline">¶</a></h3>
<p>Para generar el BIAS maestro de la primera noche necesitamos combinar las observaciones de BIAS de esa noche. Por eso es comveniente crearse una lista que contenga sus nombres. análogamente desearíamos tener listas de los ficheros de FlatFileds o otras correspondientes a observaciones obtenidas con diferentes filtros, etc.</p>
<p>Siguiendo las indicaciones en los documentos de ayuda de  <a class="reference external" href="https://ccdproc.readthedocs.io/en/latest/image_management.html">image management</a> podemos generar listas usando <a class="reference external" href="https://ccdproc.readthedocs.io/en/latest/api/ccdproc.ImageFileCollection.html#ccdproc.ImageFileCollection">ImageFileCollection</a>.</p>
<p>La primera lista sería la de todos los ficheros ya que queremos aplicarles a todos un recorte para quedarnos con la región útil. Esto no es estrictamente necesario pero es más bonito ver las imagenes recortadas y las estadísticas de las imágenes completas no incluyen esos valores oscuros similares al valor de BIAS.</p>
<p>Podemos seleccionar alguno de los <code class="docutils literal notranslate"><span class="pre">keywords</span></code> pare luego seleccionar los ficheros de acuerdo a los valores de éstos o directamente usarlos todos (keywords=’*’)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ccdproc</span> <span class="kn">import</span> <span class="n">ImageFileCollection</span>
<span class="kn">from</span> <span class="nn">ccdproc.utils.sample_directory</span> <span class="kn">import</span> <span class="n">sample_directory_with_files</span>
<span class="n">directory</span><span class="o">=</span><span class="s1">&#39;/Users/jzamorano/Desktop/NOT_2008/N1/&#39;</span>
<span class="n">ic_all</span> <span class="o">=</span> <span class="n">ImageFileCollection</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ic_all</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">colnames</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;imagetyp&#39;</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="s1">&#39;filter&#39;</span><span class="p">,</span> <span class="s1">&#39;exptime&#39;</span><span class="p">]</span>
<span class="n">ic1</span> <span class="o">=</span> <span class="n">ImageFileCollection</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="n">keys</span><span class="p">)</span> <span class="c1"># only keep track of keys</span>
<span class="n">ic1</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">colnames</span>
</pre></div>
</div>
</div>
</div>
<p>Desgraciadamente nuestros ficheros no siempre contienen relleno el keyword <code class="docutils literal notranslate"><span class="pre">ccdtype</span></code> que informa sobre el tipo de imagen y que nos facilitaría el trabajo ya que podríamos listas las imágenes de cada clase (‘bias’, ‘object’, ‘flat’  …) y tampoco <code class="docutils literal notranslate"><span class="pre">filter</span></code> así que creamos nuestra lista de keywords que usaremos en la selección.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span> <span class="p">,</span> <span class="s1">&#39;EXPTIME&#39;</span> <span class="p">,</span> <span class="s1">&#39;ALFLTID&#39;</span> <span class="p">,</span> <span class="s1">&#39;FAFLTID&#39;</span> <span class="p">,</span> <span class="s1">&#39;FBFLTID&#39;</span><span class="p">]</span>
<span class="n">ic1</span> <span class="o">=</span> <span class="n">ImageFileCollection</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="n">keys</span><span class="p">)</span> <span class="c1"># only keep track of keys</span>
<span class="n">ic1</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">colnames</span>
</pre></div>
</div>
</div>
</div>
<p>Y podríamos seleccionar, por ejemplo, las observaciones con tiempo de exposición mayor que 600s</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">matches</span> <span class="o">=</span> <span class="p">(</span><span class="n">ic1</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">600</span><span class="p">)</span>
<span class="n">my_files</span> <span class="o">=</span> <span class="n">ic1</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="n">matches</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_files</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>También se puede hacer de esta forma</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_files</span> <span class="o">=</span> <span class="n">ic1</span><span class="o">.</span><span class="n">files_filtered</span><span class="p">(</span><span class="n">FBFLTID</span><span class="o">=</span><span class="mi">78</span><span class="p">,</span> <span class="n">exptime</span><span class="o">=</span><span class="mf">3.5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">some_files</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Por último tenemos un método para seleccionar ficheros que contengan una palabra dentro de un <code class="docutils literal notranslate"><span class="pre">keyword</span></code>. Para la lista de imágenes de BIAS usaremos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bias_list</span> <span class="o">=</span> <span class="n">ic1</span><span class="o">.</span><span class="n">files_filtered</span><span class="p">(</span><span class="n">regex_match</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">imagetyp</span><span class="o">=</span><span class="s1">&#39;bias|light&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bias_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Y gracias a este método podemos crear nuestras listas de modo inteligente buscando, por ejemplo, la palabra ‘flat’ en el descriptor <code class="docutils literal notranslate"><span class="pre">object</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">list_of_flats</span> <span class="o">=</span> <span class="n">ic1</span><span class="o">.</span><span class="n">files_filtered</span><span class="p">(</span><span class="n">regex_match</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="nb">object</span><span class="o">=</span><span class="s1">&#39;flat&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">list_of_flats</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>En cualquier caso siempre se puede acudir al cuaderno de observaciones y crear las listas a mano incluyendo los nombres de los ficheros</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AL12011.fits&#39;</span> <span class="p">,</span> <span class="s1">&#39;AL12012.fits&#39;</span> <span class="p">,</span> <span class="s1">&#39;AL12013.fits&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>En el procesado que vamos a realizar se asume que los ficheros son similares y proceden de imágenes obtenidas con la misma instrumentación y en la misma campaña. Es importante detectar y retirar fichers de nuestro directorio que corresponden a imágenes de diferente tamaño, por ejemplo. Esto puede ocurrir si hemos estado tomando imágenes de prueba con una ventana recortada del CCD y se nos ha olvidado volver a la configuración de observación.</p>
<p>Podemos mirar el cuaderno de observaciones y/o listar los tamaños de todas las imágenes para detectar algún problema.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filelist</span><span class="p">)):</span>
    <span class="n">HDUList_object</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filelist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">primary_header</span> <span class="o">=</span> <span class="n">HDUList_object</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">primary_header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">],</span><span class="n">primary_header</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">],</span><span class="n">primary_header</span><span class="p">[</span><span class="s1">&#39;NAXIS1&#39;</span><span class="p">],</span><span class="n">primary_header</span><span class="p">[</span><span class="s1">&#39;NAXIS2&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<pre>
...
ALrd120060.fits Sky Flat evening 2198 2052
ALrd120061.fits Sky Flat evening 2198 2052
ALrd120062.fits Sky Flat evening 2198 2052
ALrd120063.fits Sky Flat evening 800 800
ALrd120064.fits HZ44 focusing 2198 2052
ALrd120065.fits HZ44 focusing 2198 2052
ALrd120066.fits HZ44 focusing 2198 2052
...
</pre>
<p>La imagen ALrd120063.fits ‘Sky Flat evening’ (que forma parte de una serie de enfoque) tiene dimensiones distintas: (800,800) por lo tanto hay que retirarla.</p>
<pre>
$ rm ALrd120063.fits
</pre>
</div>
<div class="section" id="sustraccion-del-overscan">
<h3>Sustracción del overscan<a class="headerlink" href="#sustraccion-del-overscan" title="Permalink to this headline">¶</a></h3>
<p>Se puede usar la región de <code class="docutils literal notranslate"><span class="pre">overscan</span></code> que representa bien la señal de DARK de la imagen para  restarla y corregirla de esta señal de BIAS + DARK. Para CCDs que no presentan señal de DARK apreciable el <code class="docutils literal notranslate"><span class="pre">overscan</span></code> representa la señal de BIAS. Esto ocurre en la mayoría de las cámaras profesionales refrigeradas. En otras cámaras la substracción del overscan mejoraría la reducción si hay pequeñas diferencias de BIAS entre exposiciones. Pero en el caso general esta señal ya la tenemos bien caracterizada en la imágenes de calibración de BIAS si el sistema tiene la temperatura bien estabilizada. Combinando esas imágenes podemos crear un master BIAS que restaremos a las imágenes de ciencia. Por lo tanto este paso no es estrictamente necesario y nos lo saltamos en este ejemplo.</p>
</div>
<div class="section" id="recorte-de-las-imagenes">
<h3>Recorte de las imágenes<a class="headerlink" href="#recorte-de-las-imagenes" title="Permalink to this headline">¶</a></h3>
<p>Es importante recordar que python tiene una manera diferente de indexar las matrices (arrays) que FITS. Mientras that python empieza los índices en 0, FITS comienza en 1, y además el orden de los índices está cambiado: (FITS sigue la convención FORTRAN y python la de C). Descripción más completa en <a class="reference external" href="https://ccdproc.readthedocs.io/en/latest/reduction_toolbox.html#subtract-overscan-and-trim-images">indexing python and FITS</a>.</p>
<p>Nuestras imágenes tienen dimensión (2198,2052) correspondiente a NAXIS = 2, NAXIS1 = 2198 y NAXIS2 = 2052. En notación FITS nuestro BIASSEC= [3:52,1:2052] lo que indica que las columnas entre 3 y 52 (52 incluido) contienen el overscan. En los corchetes aparece 1:2052 es decir que se tiene en cuenta todas las filas desde la primera 1 hasta la última 2052. Si leemos esta imagen FITS en una matriz de python el overscan sería img[0:2052,2:52] o de forma más compacta img[:,2:52] indicando todas las filas y entre las columnas 2 y 51.</p>
<p>Esto es un poco lioso pero se puede atacar de diferentes formas. Pensando en modo python (que se recomienda) o en modo FITS.</p>
<div class="section" id="aprendiendo-a-recortar">
<h4>Aprendiendo a recortar<a class="headerlink" href="#aprendiendo-a-recortar" title="Permalink to this headline">¶</a></h4>
<div class="section" id="recortar-con-python">
<h5>recortar con python<a class="headerlink" href="#recortar-con-python" title="Permalink to this headline">¶</a></h5>
<p>Después de mostar la imagen original con python comprobamos que tiene el mismo aspecto que cuando la visualizamos con DS9.</p>
<div class="figure align-default" id="ds9-6-fig">
<a class="reference internal image-reference" href="../_images/p2_02_ds9_6.png"><img alt="../_images/p2_02_ds9_6.png" src="../_images/p2_02_ds9_6.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Imagen AL12102.fits mostrada con DS9 (izquierda) y usando python (derecha). Se ha procurado usar los mismos cortes aunque son diferentes tablas de color .</span><a class="headerlink" href="#ds9-6-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Recortar un trozo de un array es fácil con python. Vamos a cortar para quedarnos con la esquina inferior izquierda,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Trimming using python </span>
<span class="n">new_image</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">1250</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="trim-1-fig">
<a class="reference internal image-reference" href="../_images/p2_03_trim_1.png"><img alt="../_images/p2_03_trim_1.png" src="../_images/p2_03_trim_1.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Imagen original y recorte usando los comandos de python para seleccionar la zona inferior izquierda del array.</span><a class="headerlink" href="#trim-1-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Usando DS9 de nuevo buscamos la región que vamos a recortar que resulta ser [20:-20,60:2100] en la convención de python. Estos valores no son críticos y, por ejemplo podríamos recortar un poco más pero no deseamos perder FoV. Entonces en python,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_image</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">60</span><span class="p">:</span><span class="mi">2100</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>De la imagen original de dimensión (2052,2198) hemos recortado una nueva imagen de prueba de  tamaño (2012,2040) porque le hemos retirado 20 filas arriba y otras 20 abajo y las primeras 60 columnas y desde la columna 2100 en adelante.</p>
<div class="figure align-default" id="trim-2-fig">
<a class="reference internal image-reference" href="../_images/p2_03_trim_2.png"><img alt="../_images/p2_03_trim_2.png" src="../_images/p2_03_trim_2.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Imagen original y recortada usando los comandos de python para seleccionar la región de interés.</span><a class="headerlink" href="#trim-2-fig" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="recortar-con-ccdproc-trim-image">
<h5>recortar con ccdproc trim_image<a class="headerlink" href="#recortar-con-ccdproc-trim-image" title="Permalink to this headline">¶</a></h5>
<p>ccdproc dispone de un comando para recorte de imágenes <a class="reference external" href="https://ccdproc.readthedocs.io/en/latest/api/ccdproc.trim_image.html#ccdproc.trim_image">trim_image</a> que permite pasar los parámetros de la zona a recortar bien en modo FITS o en modo python. La ventaja del modo FITS es que el descriptor <code class="docutils literal notranslate"><span class="pre">TRIM_SEC</span></code> se encuentra en la mayoría de las cabeceras FITS y puede ser usado directamente sin necesidad de buscar cual es la zona de recorte.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cargamos los paquetes necesarios</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">CCDData</span>
<span class="kn">import</span> <span class="nn">ccdproc</span>
<span class="c1"># Convertimos nuesto numpy array (image) en un objeto CCDData</span>
<span class="n">data_image</span> <span class="o">=</span> <span class="n">CCDData</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">adu</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># recortamos al estilo FITS</span>
<span class="n">t_image_1</span> <span class="o">=</span> <span class="n">ccdproc</span><span class="o">.</span><span class="n">trim_image</span><span class="p">(</span><span class="n">data_image</span><span class="p">,</span><span class="n">fits_section</span><span class="o">=</span><span class="s1">&#39;[60:2099, 21:2032]&#39;</span><span class="p">)</span>
<span class="c1"># y al estilo python:</span>
<span class="n">t_image_2</span> <span class="o">=</span> <span class="n">ccdproc</span><span class="o">.</span><span class="n">trim_image</span><span class="p">(</span><span class="n">data_image</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">60</span><span class="p">:</span><span class="mi">2100</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t_image_1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">t_image_2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="trim-3-fig">
<a class="reference internal image-reference" href="../_images/p2_03_trim_3.png"><img alt="../_images/p2_03_trim_3.png" src="../_images/p2_03_trim_3.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Imagenes recortadas con el comando <code class="docutils literal notranslate"><span class="pre">trim_image</span></code> en los dos modos descritos llegando al mismo resultado.</span><a class="headerlink" href="#trim-3-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Ahora podemos escribir el resultado como una imagen FITS pero queremos que conserve la cabecera del fichero original al que vamos a añadir información sobre el procesado que le hemos realizado. Por suerte el comando <code class="docutils literal notranslate"><span class="pre">trim_image</span></code>conserva la cabecera original.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace FILENAME keyword and add information</span>
<span class="n">t_image_1</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;t_ALrd120102.fits&#39;</span> 
<span class="n">t_image_1</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;TRIMIM&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;fits_section=[60:2099, 21:2032]&#39;</span> 
<span class="n">t_image_1</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())[</span><span class="mi">0</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; astropy ccdproc trim_image&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t_image_1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;dummy.fits&#39;</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="trim-4-fig">
<a class="reference internal image-reference" href="../_images/p2_03_trim_4.png"><img alt="../_images/p2_03_trim_4.png" src="../_images/p2_03_trim_4.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-text">Estas líneas se han añadido al final de la cabecera FITS de la imagen de prueba que hemos recortado dummy.fits.</span><a class="headerlink" href="#trim-4-fig" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="recortando-nuestras-imagenes">
<h4>Recortando nuestras imágenes<a class="headerlink" href="#recortando-nuestras-imagenes" title="Permalink to this headline">¶</a></h4>
<p>Como vamos a usar <code class="docutils literal notranslate"><span class="pre">ccdproc</span></code> usaremos el método descrito anteriormente para recortar todas las imágenes de la primera noche de nuestra campaña.<br />
Generamos la lista completa de imágenes simplemente explorando el directorio de los ficheros originales. Esto se hace con ayuda de utilidades de python de la siguiente manera,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;/Users/jzamorano/Desktop/NOT_2008/N1/&#39;</span>  <span class="c1"># Change to your working directory path </span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="c1"># os.path.join is a platform-independent way to join two directories</span>
<span class="n">globpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">&#39;*.fits&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">globpath</span><span class="p">)</span>
<span class="c1"># glob searches through directories similar to the Unix shell</span>
<span class="n">filelist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">globpath</span><span class="p">))</span>   <span class="c1"># sort filelist alphabetically </span>
<span class="nb">print</span><span class="p">(</span><span class="n">filelist</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">120</span><span class="p">])</span>    <span class="c1"># printing only from 10 to 20</span>
</pre></div>
</div>
</div>
</div>
<p>En la lista <code class="docutils literal notranslate"><span class="pre">filelist</span></code> tenemos almacenados los nombres de nuestros ficheros.<br />
Ahora recorremos la lista (hay formas más exquisitas de hacerlo en python)</p>
<ul class="simple">
<li><p>efectuando el recorte de cada imagen,</p></li>
<li><p>creando un nombre de fichero similar al descriptor FILENAME pero añadiéndole ‘t_’ al principio para indicar que es el fichero recortado,</p></li>
<li><p>escribiendo la información del procesado y cambiando el descriptor FILENAME,</p></li>
<li><p>creando el fichero FITS.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filelist</span><span class="p">)):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filelist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;adu&quot;</span><span class="p">)</span>
    <span class="n">t_image</span> <span class="o">=</span> <span class="n">ccdproc</span><span class="o">.</span><span class="n">trim_image</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">60</span><span class="p">:</span><span class="mi">2100</span><span class="p">])</span>
    <span class="n">name_of_file</span> <span class="o">=</span> <span class="s1">&#39;t_&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">])</span>
    <span class="n">t_image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">name_of_file</span>
    <span class="n">t_image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())[</span><span class="mi">0</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; astropy ccdproc trim_image&#39;</span>
    <span class="n">t_image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;trimming fits_section=[60:2099, 21:2032]&#39;</span> 
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;writting &#39;</span><span class="o">+</span><span class="n">name_of_file</span><span class="o">+</span> <span class="s1">&#39; in &#39;</span><span class="o">+</span><span class="n">directory</span><span class="p">)</span>
    <span class="n">t_image</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="n">name_of_file</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Los ficheros se han creado en el mismo directorio del que leimos las imágenes. La recomendación es dejarlos ahí y crear un subdirectorio para meter las imágenes originales. De esta forma nuestro directorio de trabajo sigue siendo el mismo y las imágenes originales siguen a nuestra disposición por si nos equivocamos en alguno de los pasos. Tendríamos entonces</p>
<pre>
NOT_2008/N1                directorio de trabajo con los t_AL*.fits ficheros recortados
NOT_2008/N1/0_originales   donde moveríamos los ficheros originales 
                           $> mkdir 0_originales
                           $> mv AL*.fits originales/.
</pre>
</div>
</div>
<div class="section" id="generacion-del-master-bias">
<h3>Generación del master BIAS<a class="headerlink" href="#generacion-del-master-bias" title="Permalink to this headline">¶</a></h3>
<p>Combinando los BIAS obtendremos un master_BIAS o master_DARK que será el que usemos en la correción de BIAS. Como veremos se consigue una imagen con menor dispersión y en la que desaparecen los píxeles de alta señal correspondientes a la llegada de rayos cósmicos mientras se lee el detector.</p>
<p>Podemos empezar preparando la lista completa de ficheros en nuestro directorio de trabajo. De ella seleccionaremos luego los ficheros de BIAS de esa noche como hemos aprendido antes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="n">directory</span><span class="o">=</span><span class="s1">&#39;/Users/jzamorano/Desktop/NOT_2008/N1/&#39;</span>   <span class="c1"># write here your working directory</span>
<span class="c1"># os.path.join is a platform-independent way to join two directories</span>
<span class="n">globpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">&#39;t_*.fits&#39;</span><span class="p">)</span>      <span class="c1"># already trimmed files names begin with &#39;t_&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">globpath</span><span class="p">)</span>
<span class="c1"># glob searches through directories similar to the Unix shell</span>
<span class="n">filelist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">globpath</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">filelist</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">105</span><span class="p">])</span>    <span class="c1"># printing only from 10 to 20</span>
</pre></div>
</div>
</div>
</div>
<p>Nos preparamos para buscar los ficheros de BIAS de nuestra lista completa de imágenes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ccdproc</span> <span class="kn">import</span> <span class="n">ImageFileCollection</span>
<span class="kn">from</span> <span class="nn">ccdproc.utils.sample_directory</span> <span class="kn">import</span> <span class="n">sample_directory_with_files</span>
<span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;imagetyp&#39;</span><span class="p">,</span><span class="s1">&#39;OBJECT&#39;</span> <span class="p">,</span> <span class="s1">&#39;EXPTIME&#39;</span> <span class="p">,</span> <span class="s1">&#39;ALFLTID&#39;</span> <span class="p">,</span> <span class="s1">&#39;FAFLTID&#39;</span> <span class="p">,</span> <span class="s1">&#39;FBFLTID&#39;</span><span class="p">]</span>
<span class="n">ic1</span> <span class="o">=</span> <span class="n">ImageFileCollection</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="n">keys</span><span class="p">)</span> <span class="c1"># only keep track of keys</span>
<span class="n">ic1</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">colnames</span>
<span class="nb">print</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Seleccionamos los que tienen ‘BIAS’ en el descriptor <code class="docutils literal notranslate"><span class="pre">imagetyp</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">matches</span> <span class="o">=</span> <span class="p">(</span><span class="n">ic1</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;imagetyp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;BIAS&#39;</span><span class="p">)</span> 
<span class="n">my_bias_files</span> <span class="o">=</span> <span class="n">ic1</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="n">matches</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_bias_files</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Leemos los ficheros a objetos CCDData ya que queremos usar <code class="docutils literal notranslate"><span class="pre">ccdproc</span></code>para combinarlos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image_bias</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">my_bias_files</span><span class="p">:</span>
    <span class="n">image_bias</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="n">file</span><span class="p">))</span> <span class="c1">#, unit=&quot;adu&quot;))</span>
</pre></div>
</div>
</div>
</div>
<p>La recomendación es visualizarlos con DS9 para comprobar que son todos útiles y que no hay alguno con dimensiones distintas o algún otro problema. Podemos hacer un poco de estadística.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filename          Object        exp Mean std min  max&#39;</span><span class="p">)</span>
<span class="n">exposure</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">my_bias_files</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">],</span> 
          <span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">],</span> 
          <span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">],</span> 
          <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span> 
          <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span> 
          <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> 
          <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<pre>
Filename          Object        exp Mean std min  max
t_ALrd120001.fits Bias afternoon 0.0 353 7 311 10680
t_ALrd120002.fits Bias afternoon 0.0 355 8 313 10558
t_ALrd120003.fits Bias afternoon 0.0 357 8 314 8746
t_ALrd120004.fits Bias afternoon 0.0 358 5 312 5407
t_ALrd120005.fits Bias afternoon 0.0 358 7 313 8782
t_ALrd120006.fits Bias afternoon 0.0 358 5 317 4349
t_ALrd120007.fits Bias afternoon 0.0 358 4 317 1631
t_ALrd120008.fits Bias afternoon 0.0 358 10 317 10974
t_ALrd120009.fits Bias afternoon 0.0 358 4 316 1518
t_ALrd120010.fits Bias afternoon 0.0 358 6 319 7516
</pre>
<p>Y también preparar unos histogramas para comprobar que son similares entre sí.<br />
Para hacer el histograma se necesita</p>
<ul class="simple">
<li><p>usar los datos del objeto <code class="docutils literal notranslate"><span class="pre">CCDData</span></code>  image_bias[i].data</p></li>
<li><p>colapsar el array resultante a una dimensión con <code class="docutils literal notranslate"><span class="pre">flatten()</span></code>  image_bias[i].data.flatten()</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>astropy dispone de una rutina de histograma más completa si se desea:  <a class="reference external" href="https://docs.astropy.org/en/stable/api/astropy.visualization.hist.html#astropy.visualization.hist">astropy hist</a>.<br />
Esa rutina de histograma forma parte de <a class="reference external" href="https://docs.astropy.org/en/stable/visualization/index.html#module-astropy.visualization">astropy Data Visualization</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">330</span><span class="p">,</span> <span class="mi">380</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span> <span class="c1">#len(my_bias_files)):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">340</span><span class="p">,</span><span class="mi">360</span><span class="p">,</span><span class="mi">380</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;BIAS &#39;</span><span class="o">+</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">:</span><span class="mi">12</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">label_outer</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">330</span><span class="p">,</span><span class="mi">380</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span> <span class="c1">#len(my_bias_files)):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">340</span><span class="p">,</span><span class="mi">360</span><span class="p">,</span><span class="mi">380</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;BIAS &#39;</span><span class="o">+</span><span class="n">image_bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">][</span><span class="mi">8</span><span class="p">:</span><span class="mi">12</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">label_outer</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">330</span><span class="p">,</span><span class="mi">380</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Hemos elegido representar entre valores cercanos al valor medio que encontramos antes</p>
<div class="figure align-default" id="bias-1-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_1.png"><img alt="../_images/p2_04_bias_1.png" src="../_images/p2_04_bias_1.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Histograma de las imágenes de BIAS correspondientes a la noche primera.</span><a class="headerlink" href="#bias-1-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="bias-2-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_2.png"><img alt="../_images/p2_04_bias_2.png" src="../_images/p2_04_bias_2.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Representación de las imágenes de BIAS usando los mismos cortes. Se aprecian pequeñas diferencias.</span><a class="headerlink" href="#bias-2-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="bias-3-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_3.png"><img alt="../_images/p2_04_bias_3.png" src="../_images/p2_04_bias_3.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Imagen del último BIAS de la serie de 10 y detalle del mismo en una región con impactos aparentes de rayos cósmicos.</span><a class="headerlink" href="#bias-3-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Para combinar las imágenes de BIAS usaremos algunos paquetes de astropy</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Some astropy packages </span>
<span class="kn">import</span> <span class="nn">ccdproc</span>
<span class="kn">from</span> <span class="nn">ccdproc</span> <span class="kn">import</span> <span class="n">CCDData</span><span class="p">,</span> <span class="n">Combiner</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">astropy.stats</span> <span class="kn">import</span> <span class="n">sigma_clip</span><span class="p">,</span> <span class="n">mad_std</span>
<span class="kn">from</span> <span class="nn">astropy.stats</span> <span class="kn">import</span> <span class="n">sigma_clipped_stats</span>
</pre></div>
</div>
</div>
</div>
<p>Para combinar imágenes <code class="docutils literal notranslate"><span class="pre">astropy</span></code> dispone de <code class="docutils literal notranslate"><span class="pre">Combiner</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Combiner is a class for combining CCDData objects.</span>
<span class="c1"># https://ccdproc.readthedocs.io/en/latest/api/ccdproc.Combiner.html</span>
<span class="c1"># The Combiner class is used to combine together CCDData objects </span>
<span class="c1"># including the method for combining the data, rejecting outlying data, </span>
<span class="c1"># and weighting used for combining frames.</span>

<span class="n">combiner</span> <span class="o">=</span> <span class="n">Combiner</span><span class="p">(</span><span class="n">image_bias</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Antes de combinar podemos rechazar los valores altos que aparecen en los píxeles impactados por rayos cósmicos.<br />
El master_dark se puede ahora crear con la combinación de nuestro gusto. Para 10 ficheros de BIAS las diferencias van a ser mínimas entre <code class="docutils literal notranslate"><span class="pre">median_combine</span></code> o <code class="docutils literal notranslate"><span class="pre">mean_combine</span></code>. Puede leerse sobre este tema en: <a class="reference external" href="https://mwcraig.github.io/ccd-as-book/01-06-Image-combination.html">CCD data reduction guide  Image combination</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># clipping all values over 800 to remove cosmic rays hits </span>
<span class="n">combiner</span><span class="o">.</span><span class="n">minmax_clipping</span><span class="p">(</span><span class="n">min_clip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_clip</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
<span class="c1"># median combine </span>
<span class="n">master_dark</span> <span class="o">=</span> <span class="n">combiner</span><span class="o">.</span><span class="n">median_combine</span><span class="p">()</span>
<span class="c1"># median filter  </span>
<span class="n">master_dark_filtered</span> <span class="o">=</span> <span class="n">ccdproc</span><span class="o">.</span><span class="n">median_filter</span><span class="p">(</span><span class="n">master_dark</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="bias-4-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_4.png"><img alt="../_images/p2_04_bias_4.png" src="../_images/p2_04_bias_4.png" style="width: 800px;" /></a>
<p class="caption"><span class="caption-text">Detalles de y estadística (media y desviación estándar) de una imagen individual de BIAS y la combinación de mediana. La última imagen es el resultado de aplicar un filtro de mediana a éste último dark. La región amarilla presenta una estadística con mayor desviación debido a los impactos de rayos cósmicos pero en el master_dark este problema se arregla. Nótese que los píxeles de valor alto han desaparecido.</span><a class="headerlink" href="#bias-4-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Copiamos la cabecera de uno de los BIAS y le añadimos información del procesado hasta llegar al master_dark. usamos como FILENAME ‘N1_master_dark’ que es un nombre más descriptivo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copy primary header from single dark file and copy into master_dark header</span>
<span class="n">master_dark</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">image_bias</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace FILENAME keyword and add information</span>
<span class="n">master_dark</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;super DARK combining &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_bias</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; BIAS images&#39;</span>
<span class="n">master_dark</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>  <span class="o">=</span>  <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())[</span><span class="mi">0</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; astropy median combine&#39;</span>
<span class="n">master_dark</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;BIAS images from &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_bias</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">])</span>
<span class="n">master_dark</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N1_master_dark&#39;</span> 
</pre></div>
</div>
</div>
</div>
<p>A continuación escribimos esta imagen como fichero FITS en el directorio de trabajo como ‘zero_N1.fits’</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">master_dark</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="s1">&#39;zero_N1.fits&#39;</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="bias-5-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_5.png"><img alt="../_images/p2_04_bias_5.png" src="../_images/p2_04_bias_5.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-text">Estas tres líneas aparecen en el final de la cabecera del master_dark informando de cómo se ha preparado esta imagen. Se conservan las dos primeras líneas de HISTORY donde se apuntaba el recorte (‘trimming’) que habían sufrido anteriormente.</span><a class="headerlink" href="#bias-5-fig" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="correccion-de-bias">
<h3>Corrección de bias<a class="headerlink" href="#correccion-de-bias" title="Permalink to this headline">¶</a></h3>
<p>En este paso utilizaremos el master_DARK (o master_BIAS) para corregir todas las imágenes de este nivel de BIAS. No es necesario seleccionar por filtro empleado en este caso porque el nivel es independiente de la cantidad y tipo de luz que llegue al chip.</p>
<p>Si hemos seguido los pasos anteriores nuestro master DARK se llama ‘zero_N1.fits’ y se encuentra en nuestro directorio de trabajo. En este directorio están también las imágenes recortadas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># reading master_bias from &#39;zero_N1.fits&#39;</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;zero_N1.fits&#39;</span>
<span class="n">master_bias</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Haremos una corrección de BIAS en dos imágenes como ejemplo para ver que el comando ccdproc_subtract_bias que usaremos luego es una simple resta de imágenes. Una de ellas es una observación de nuestro proyecto y la otra una imagen de calibración, uno de los BIAS individuales que usamos para construir el maaster BIAS.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">science</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filelist</span><span class="p">[</span><span class="mi">102</span><span class="p">])</span>    <span class="c1"># file with a science observation</span>
<span class="n">onebias</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filelist</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>      <span class="c1"># file with a single BIAS frame</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Statistics of the example images</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filename          Object            exp  Mean std min  max&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">science</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">],</span> <span class="n">science</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">],</span> <span class="n">science</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">],</span> 
          <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">science</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">science</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">science</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">science</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bias</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">],</span> <span class="n">onebias</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">],</span> <span class="n">onebias</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">],</span> 
          <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">onebias</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">onebias</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">onebias</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">onebias</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<pre>
Filename          Object            exp  Mean std min  max
t_ALrd120103.fits GC4496A R 3x300s 300.0 6431 456 367 65535
t_ALrd120010.fits Bias afternoon 0.0 358 6 319 7516
</pre>
<p>La imagen de ciencia es la primera observación de una serie de tres observaciones de 300s de exposición de NGC4496A con el filtro R. Nótese que el observador puso ‘GC4496A’ en lugar de ‘NGC4496A’. El valor máximo es de 65535 que resulta ser el número más alto que se puede reperesentar con números binarios de 16-bits (unsigned) y por lo tanto indica que hay algún píxel completamente saturado.  ( 65535 =  2^16 -1 )</p>
<div class="figure align-default" id="bias-6-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_6.png"><img alt="../_images/p2_04_bias_6.png" src="../_images/p2_04_bias_6.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-text">Imágenes de prueba a las que vamos a restar el master BIAS. Los recuadros muestran el valor medio y la desviación estándar.</span><a class="headerlink" href="#bias-6-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Corrección de BIAS usando numpy subtract</span>
<span class="n">onebias_minus_bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">onebias</span><span class="p">,</span><span class="n">master_bias</span><span class="p">)</span>
<span class="n">science_minus_bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">science</span><span class="p">,</span><span class="n">master_bias</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="bias-7-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_7.png"><img alt="../_images/p2_04_bias_7.png" src="../_images/p2_04_bias_7.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-text">Las imágenes de prueba a las que hemos restado el master BIAS. Los recuadros muestran el valor medio y la desviación estándar. Como esperábamos la señal de un BIAS al que restamos un master BIAS se queda en cero y la desviación típica no cambia. En el caso de la imagen de ciencia tenemos el nivel reducido en unas 358 cuentas (el valor medio del master BIAS).</span><a class="headerlink" href="#bias-7-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Corregir con el comando de ccdproc es muy sencillo y produce el mismo resultado.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Corrección de BIAS usando numpy subtract</span>
<span class="n">bias_subtracted_onebias</span> <span class="o">=</span> <span class="n">ccdproc</span><span class="o">.</span><span class="n">subtract_bias</span><span class="p">(</span><span class="n">onebias</span><span class="p">,</span> <span class="n">master_bias</span><span class="p">)</span>
<span class="n">bias_subtracted_science</span> <span class="o">=</span> <span class="n">ccdproc</span><span class="o">.</span><span class="n">subtract_bias</span><span class="p">(</span><span class="n">science</span><span class="p">,</span> <span class="n">master_bias</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="bias-8-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_8.png"><img alt="../_images/p2_04_bias_8.png" src="../_images/p2_04_bias_8.png" style="width: 700px;" /></a>
<p class="caption"><span class="caption-text">Las imágenes de prueba a las que vamos hemos restado el master BIAS usando ccdproc.subtract_bias). El resultado es idéntico.</span><a class="headerlink" href="#bias-8-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="corrigiendo-todas-las-imagenes">
<h4>Corrigiendo todas las imágenes<a class="headerlink" href="#corrigiendo-todas-las-imagenes" title="Permalink to this headline">¶</a></h4>
<p>Este sencillo paso que haremos a continuación falla al llegar al fichero ‘t_ALrd120063.fits’ ya que ésta es una imagen de menor tamaño. Esta observación es un enfoque del telescopio y no tiene utilidad científica. Por eso es conveniente mirar el cuaderno de observaciones. Por lo tanto la borramos.</p>
<pre>
$ rm t_ALrd120063.fits
</pre>
<p>ahora simplemente recorremos toda la lista de imágenes y para cada una de ellas efectuamos la substracción de BIAS, le cambiamos el nombre añadiendo una z (de ‘zero corrected’) y añadimos información con descriptores HISTORY.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filelist</span><span class="p">)):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filelist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1">#, unit=&quot;adu&quot;)</span>
    <span class="n">z_image</span> <span class="o">=</span> <span class="n">ccdproc</span><span class="o">.</span><span class="n">subtract_bias</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">master_bias</span><span class="p">)</span>
    <span class="n">name_of_file</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">])</span>
    <span class="n">z_image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">name_of_file</span>
    <span class="n">z_image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())[</span><span class="mi">0</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; astropy ccdproc substract_bias&#39;</span>
    <span class="n">z_image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s1">&#39;using NOT2008/N1/zero_N1.fits master BIAS&#39;</span> 
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;writting &#39;</span><span class="o">+</span><span class="n">name_of_file</span><span class="o">+</span> <span class="s1">&#39; in &#39;</span><span class="o">+</span><span class="n">directory</span><span class="p">)</span>
    <span class="n">z_image</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="n">name_of_file</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Si todo ha ido bien tendremos en el directorio de trabajo imágenes con nombre ‘zt_ALrd120062.fits’ por ejemplo y que en cuya cabecera FITS se puede leer la información de su procesado.</p>
<div class="figure align-default" id="bias-9-fig">
<a class="reference internal image-reference" href="../_images/p2_04_bias_9.png"><img alt="../_images/p2_04_bias_9.png" src="../_images/p2_04_bias_9.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Estas líneas aparecen en el final de la cabecera de las imágenes corregidas de BIAS informando de cómo se ha procesado esta imagen. Se conservan las dos primeras líneas de HISTORY donde se apuntaba el recorte (‘trimming’) que habían sufrido anteriormente.</span><a class="headerlink" href="#bias-9-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Los ficheros se han creado en el mismo directorio del que leimos las imágenes. La recomendación es dejarlos ahí y crear un subdirectorio para meter las imágenes recortadas (primer paso). De esta forma nuestro directorio de trabajo sigue siendo el mismo y las imágenes originales y recortadas siguen a nuestra disposición por si nos equivocamos en alguno de los pasos. Tendríamos entonces</p>
<pre>
NOT_2008/N1                directorio de trabajo con los t_AL*.fits ficheros recortados
NOT_2008/N1/0_originales   donde mantenemos los ficheros antes de procesado
NOT_2008/N1/1_recortados   donde almacenaremos el resultado del primer paso 
                           $> mkdir 1_recortados
                           $> mv t_AL*.fits 1_recortados/.
</pre>
<p>Si hacemos un listado nuestro directorio de trabajo tendrá este aspecto:</p>
<pre>
N1 jzamorano$ ls
0_originales       zt_ALrd120011.fits zt_ALrd120024.fits zt_ALrd120037.fits zt_ALrd120050.fits
1_recortados       zt_ALrd120012.fits zt_ALrd120025.fits zt_ALrd120038.fits zt_ALrd120051.fits
zero_N1.fits       zt_ALrd120013.fits zt_ALrd120026.fits zt_ALrd120039.fits zt_ALrd120052.fits
zt_ALrd120001.fits zt_ALrd120014.fits zt_ALrd120027.fits zt_ALrd120040.fits zt_ALrd120053.fits
zt_ALrd120002.fits zt_ALrd120015.fits zt_ALrd120028.fits zt_ALrd120041.fits zt_ALrd120054.fits
zt_ALrd120003.fits zt_ALrd120016.fits zt_ALrd120029.fits zt_ALrd120042.fits zt_ALrd120055.fits
zt_ALrd120004.fits zt_ALrd120017.fits zt_ALrd120030.fits zt_ALrd120043.fits zt_ALrd120056.fits
zt_ALrd120005.fits zt_ALrd120018.fits zt_ALrd120031.fits zt_ALrd120044.fits zt_ALrd120057.fits
zt_ALrd120006.fits zt_ALrd120019.fits zt_ALrd120032.fits zt_ALrd120045.fits zt_ALrd120058.fits
zt_ALrd120007.fits zt_ALrd120020.fits zt_ALrd120033.fits zt_ALrd120046.fits zt_ALrd120059.fits
...
</pre>
</div>
</div>
<div class="section" id="generacion-de-un-master-flat-field-por-filtro">
<h3>Generación de un máster flat field por filtro<a class="headerlink" href="#generacion-de-un-master-flat-field-por-filtro" title="Permalink to this headline">¶</a></h3>
<p>El FlatField representa la respuesta espacial del CCD y necesitamos determinarlo bien ya que se aplicará a todas las imágenes para corregir este efecto. Normalmente se obtienen FlatFields de cúpula y FlatField de cielo. En el primer caso tenemos la ventaja de disponer del tiempo que sea necesario ya que se trata de iluminar la cúpula con lámparas y tomar imágenes. Los FlatField de cielo se toman en los crepúsculos apuntando el telescopio a regiones libres de estrellas brillantes (Blank Fields). No siempre es fácil conseguirlos ya que el tiempo es limitado y las condiciones de luz varían muy rápidamente. Recordemos que deben tomarse para cada filtro de los que se estén empleando. En primera aproximación, se prefiere FlatField de cielo ya que reproduce mejor el color del cielo pero si no son de calidad suficiente o no se dispone de ellos se usan los de cúpula.</p>
<p>Veamos de cuantos FlatField disponemos y si son de calidad suficiente. Para buscamos en el resultado los ficheros correspondientes a FlatFields. Ya vimos que esta información aparece en el nombre del objeto observado <code class="docutils literal notranslate"><span class="pre">object</span></code> pero no en el descriptor <code class="docutils literal notranslate"><span class="pre">ccdtype</span></code> como es lo habitual. Puede usarse también el cuaderno de observaciones para comprobar. Usamos Image.Collection que ya aprendimos a usar antes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;imagetyp&#39;</span><span class="p">,</span><span class="s1">&#39;OBJECT&#39;</span> <span class="p">,</span> <span class="s1">&#39;EXPTIME&#39;</span> <span class="p">,</span> <span class="s1">&#39;ALFLTID&#39;</span> <span class="p">,</span> <span class="s1">&#39;FAFLTID&#39;</span> <span class="p">,</span> <span class="s1">&#39;FBFLTID&#39;</span><span class="p">]</span>
<span class="n">ic1</span> <span class="o">=</span> <span class="n">ImageFileCollection</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="n">keys</span><span class="p">)</span> <span class="c1"># only keep track of keys</span>
<span class="n">ic1</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">colnames</span>
<span class="nb">print</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<pre>
['imagetyp', 'OBJECT', 'EXPTIME', 'ALFLTID', 'FAFLTID', 'FBFLTID']
</pre><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">list_of_flats</span> <span class="o">=</span> <span class="n">ic1</span><span class="o">.</span><span class="n">files_filtered</span><span class="p">(</span><span class="n">regex_match</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="nb">object</span><span class="o">=</span><span class="s1">&#39;flat&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">list_of_flats</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<pre>
['zt_ALrd120011.fits' 'zt_ALrd120012.fits' 'zt_ALrd120013.fits'
 'zt_ALrd120014.fits' 'zt_ALrd120015.fits' 'zt_ALrd120016.fits'
 'zt_ALrd120017.fits' 'zt_ALrd120018.fits' 'zt_ALrd120019.fits'
 'zt_ALrd120020.fits' 'zt_ALrd120021.fits' 'zt_ALrd120022.fits'
 'zt_ALrd120023.fits' 'zt_ALrd120024.fits' 'zt_ALrd120025.fits'
...
 'zt_ALrd120056.fits' 'zt_ALrd120057.fits' 'zt_ALrd120058.fits'
 'zt_ALrd120059.fits' 'zt_ALrd120060.fits' 'zt_ALrd120061.fits'
 'zt_ALrd120062.fits']
</pre>
<p>O mejor todavía listamos los ficheros, sus nombres, filtros y tiempo de exposición. La identificación de los filtros de las observaciones con filtros de banda ancha aparece en ‘ALFLTID’ y las correspondientes a banda estrecha (que se colocan en FASU B) en  ‘FBFLTID’</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">list_of_flats</span><span class="p">)):</span>
    <span class="n">HDUList_object</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="n">list_of_flats</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">primary_header</span> <span class="o">=</span> <span class="n">HDUList_object</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">primary_header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">],</span><span class="n">primary_header</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">],</span><span class="n">primary_header</span><span class="p">[</span><span class="s1">&#39;exptime&#39;</span><span class="p">]</span>
          <span class="p">,</span><span class="n">primary_header</span><span class="p">[</span><span class="s1">&#39;ALFLTID&#39;</span><span class="p">],</span><span class="n">primary_header</span><span class="p">[</span><span class="s1">&#39;FBFLTID&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<pre>
zt_ALrd120011.fits Dome Flat R 1.0 76 0
zt_ALrd120012.fits Dome Flat R 1.0 76 0
zt_ALrd120013.fits Dome Flat R 1.0 76 0
zt_ALrd120014.fits Dome Flat R 1.0 76 0
...
zt_ALrd120049.fits Sky Flat evening 11.0 0 78
zt_ALrd120050.fits Sky Flat evening 17.0 0 78
zt_ALrd120051.fits Sky Flat evening 18.0 0 49
zt_ALrd120052.fits Sky Flat evening 27.0 0 49
zt_ALrd120053.fits Sky Flat evening 43.0 0 49
zt_ALrd120054.fits Sky Flat evening 10.0 0 49
...
zt_ALrd120059.fits Sky Flat evening 4.9 76 0
zt_ALrd120060.fits Sky Flat evening 7.0 76 0
zt_ALrd120061.fits Sky Flat evening 10.0 76 0
zt_ALrd120062.fits Sky Flat evening 15.0 76 0
</pre>
<p>Con esta información y la del cuaderno de observación tenemos una tabla completa donde ya anticipa algunos problemas de exceso de cuentas o filtro girado. Como siempre visualizarlo con DS9 ayuda a salir de dudas.</p>
<pre>
zt_AL12011-ztAL12020   Dome Flat R       1s 
zt_AL12021             Dome Flat NB#78   10s   9 kcuentas
zt_AL12022             Dome Flat NB#49   30s  39 kc demasiado alto
zt_AL12023-zt_AL12032  Dome Flat NB#78   30s  24
zt_AL12033-zt_AL12042  Dome Flat NB#49   20s  no valen (filtro girado)
zt_AL12043             Dome Flat NB#49   10s  filtro en posición correcta

zt_AL12044             Sky Flat NB#78    0.1s   3 kc
zt_AL12045             Sky Flat NB#78    1.2s  11 kc
zt_AL12046             Sky Flat NB#78    3.5s  27 kc
zt_AL12047             Sky Flat NB#78    5.0s  30 kc
zt_AL12048             Sky Flat NB#78    7.5s  29 kc
zt_AL12049             Sky Flat NB#78     11s  32 kc
zt_AL12050             Sky Flat NB#78     17s  31 kc
zt_AL12051             Sky Flat NB#49     18s  30 kc
zt_AL12052             Sky Flat NB#49     27s  30 kc
zt_AL12053             Sky Flat NB#49     43s  28 kc a otro blank field
zt_AL12054             Sky Flat NB#49     10s  18 kc
zt_AL12055             Sky Flat NB#49     22s  24 kc
zt_AL12056             Sky Flat NB#49     33s  24 kc

zt_AL12057             Sky Flat #76      2.5s  26 kc   Filtro R de Bessel
zt_AL12058             Sky Flat #76      3.3s  24 kc
zt_AL12059             Sky Flat #76      4.9s  27 kc
zt_AL12060             Sky Flat #76      7.0s  27 kc
zt_AL12061             Sky Flat #76       10s  28 kc
zt_AL12062             Sky Flat #76       15s  27 kc
</pre>
<div class="figure align-default" id="flats-1-fig">
<a class="reference internal image-reference" href="../_images/p2_05_flats_1.png"><img alt="../_images/p2_05_flats_1.png" src="../_images/p2_05_flats_1.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Imágenes de flats zt_ALrd120033 y zt_ALrd120043. La primera muestra el filtro descolocado en la rueda de filtros. Toda la serie con ese problema debe descartarse. Los observadores se dieron cuenta al final de la serie de 10 flats y se puedo corregir el problema.</span><a class="headerlink" href="#flats-1-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Se aprenden varias cosas con esta tabla construida con el cuaderno de observaciones: (a) Se ha buscado que los FlatField tengan alrededor de 30 kc para que, siendo un nivel alto, estemos seguros de estar en el régimen lineal del CCD; (b) Los filtros estrechos se han observado antes que el filtro ancho ya que en la puesta de sol cada vez tenemos menos luz disponible y (c) se ha conseguido un buen registro de FlatFields de cielo con un nivel de cuentas adecuado. Para el cálculo de los tiempos de exposición se usaron las tablas que aparecen en Tyson et al. (1993) AJ 105,1206. Los valores de señal en cada imagen se pueden obtener realizando estadística para comprobar que coinciden con lo anotado en el cuaderno de observaciones.</p>
<p>En nuestro caso tenemos tres filtros empleados y un número reducido de imágenes y mejor que hacer un procedimiento automático trae cuenta generar directamente las listas de ficheros correspondientes a FLATS de cada banda fotométrica. así que tras la inspección de las imágenes decidimos incluir en las listas los ficheros</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FF_list_78</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;120044&#39;</span> <span class="p">,</span> <span class="s1">&#39;120045&#39;</span> <span class="p">,</span> <span class="s1">&#39;120046&#39;</span> <span class="p">,</span> <span class="s1">&#39;120047&#39;</span>
            <span class="p">,</span> <span class="s1">&#39;120048&#39;</span> <span class="p">,</span> <span class="s1">&#39;120049&#39;</span> <span class="p">,</span> <span class="s1">&#39;120050&#39;</span><span class="p">]</span>
<span class="n">FF_list_49</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;120051&#39;</span> <span class="p">,</span> <span class="s1">&#39;120052&#39;</span> <span class="p">,</span> <span class="s1">&#39;120053&#39;</span> 
            <span class="p">,</span> <span class="s1">&#39;120054&#39;</span> <span class="p">,</span> <span class="s1">&#39;120055&#39;</span> <span class="p">,</span> <span class="s1">&#39;120056&#39;</span><span class="p">]</span>
<span class="n">FF_list_76</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;120057&#39;</span> <span class="p">,</span> <span class="s1">&#39;120058&#39;</span> <span class="p">,</span> <span class="s1">&#39;120059&#39;</span> 
            <span class="p">,</span> <span class="s1">&#39;120060&#39;</span> <span class="p">,</span> <span class="s1">&#39;120061&#39;</span> <span class="p">,</span> <span class="s1">&#39;120062&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>donde para ahorrarnos ecribir sólo hemos puesto parte del nombre. Así 120044 corresponde al fichero ALrd120044.fits.</p>
<p>Leemos los ficheros correspondientes a cada filtro</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image_flats_78</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">FF_list_78</span><span class="p">:</span>
    <span class="n">image_flats_78</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="s1">&#39;zt_ALrd&#39;</span><span class="o">+</span><span class="n">file</span><span class="o">+</span><span class="s1">&#39;.fits&#39;</span><span class="p">))</span> 
<span class="n">image_flats_49</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">FF_list_49</span><span class="p">:</span>
    <span class="n">image_flats_49</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="s1">&#39;zt_ALrd&#39;</span><span class="o">+</span><span class="n">file</span><span class="o">+</span><span class="s1">&#39;.fits&#39;</span><span class="p">))</span> 
<span class="n">image_flats_76</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">FF_list_76</span><span class="p">:</span>
    <span class="n">image_flats_76</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="s1">&#39;zt_ALrd&#39;</span><span class="o">+</span><span class="n">file</span><span class="o">+</span><span class="s1">&#39;.fits&#39;</span><span class="p">))</span> 
</pre></div>
</div>
</div>
</div>
<p>para poder trabajar con ellos. De momento es interesante visualizarlos y hacer un poco de estadística. No queremos usar una imagen con poca señal para combinar con otras de mejor calidad porque seguramente estropearemos el resultado.</p>
<div class="figure align-default" id="flats-2-fig">
<a class="reference internal image-reference" href="../_images/p2_05_flats_2.png"><img alt="../_images/p2_05_flats_2.png" src="../_images/p2_05_flats_2.png" style="width: 800px;" /></a>
<p class="caption"><span class="caption-text">Se muestran seis de los Flats correspondientes al filtro estrecho #78 tomadas consecutivamente en el crepúsculo vespertino.</span><a class="headerlink" href="#flats-2-fig" title="Permalink to this image">¶</a></p>
</div>
<p>El oscurecimiento del cielo es muy rápido y la cantidad de luz disponible es cada vez menor por lo que los observadores deben aumentar el tiempo de exposición en cada toma para lograr imágenes con al señal adecuada. En este caso se pretendía obtener unas 30 mil cuentas y se fue aumentando la exposición al principio hasta llegar a ese valor y se eligió el tiempo de las siguientes tomas para mantenerlo en ese nivel.</p>
<p>Como los dos primeros FLATs tienen menos cuentas podríamos retirarlos de la combinación. Desde luego el primero con 3000 cuentas frente a 30000 hay que retirarlo. Como tenemos suficientes retiramos los dos primeros</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#FF_list_78 = [&#39;120044&#39; , &#39;120045&#39; , &#39;120046&#39; , &#39;120047&#39;</span>
<span class="c1">#            , &#39;120048&#39; , &#39;120049&#39; , &#39;120050&#39;]</span>
<span class="n">FF_list_78</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;120046&#39;</span> <span class="p">,</span> <span class="s1">&#39;120047&#39;</span><span class="p">,</span> <span class="s1">&#39;120048&#39;</span> <span class="p">,</span> <span class="s1">&#39;120049&#39;</span> <span class="p">,</span> <span class="s1">&#39;120050&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="flats-3-fig">
<a class="reference internal image-reference" href="../_images/p2_05_flats_3.png"><img alt="../_images/p2_05_flats_3.png" src="../_images/p2_05_flats_3.png" style="width: 800px;" /></a>
<p class="caption"><span class="caption-text">Se muestran dos de los Flats correspondientes al filtro ancho #76 (filtro R de Bessel) tomadas consecutivamente en el crepúsculo vespertino.</span><a class="headerlink" href="#flats-3-fig" title="Permalink to this image">¶</a></p>
</div>
<p>En este caso las observaciones con filtro ancho (más señal que en los estrechos) se realizaron al final del crepúsculo cuando ya estaba el cielo más oscuro. En estas dos últimas tomas se aprecia la imagen de una estrella. Los apuntados del telescopio para Flats de cielo se hacen a zonas ‘libres de estrellas’ (‘Blank fields’) para evitar en lo posible que suceda esto. Además entre cada toma se mueve un poco el telescopio para que las posibles imágenes de estrellas aparezcan en diferentes lugares del detector.</p>
<p>Agrupamos los ficheros correspondientes a los FLats de cada filtro en un <code class="docutils literal notranslate"><span class="pre">combiner</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">combiner_49</span> <span class="o">=</span> <span class="n">Combiner</span><span class="p">(</span><span class="n">image_flats_49</span><span class="p">)</span>
<span class="n">combiner_76</span> <span class="o">=</span> <span class="n">Combiner</span><span class="p">(</span><span class="n">image_flats_76</span><span class="p">)</span>
<span class="n">combiner_78</span> <span class="o">=</span> <span class="n">Combiner</span><span class="p">(</span><span class="n">image_flats_78</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>y combinamos para cada filtro</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># median combine </span>
<span class="n">master_flat_76</span> <span class="o">=</span> <span class="n">combiner_76</span><span class="o">.</span><span class="n">median_combine</span><span class="p">()</span>
<span class="n">master_flat_78</span> <span class="o">=</span> <span class="n">combiner_78</span><span class="o">.</span><span class="n">median_combine</span><span class="p">()</span>
<span class="n">master_flat_49</span> <span class="o">=</span> <span class="n">combiner_49</span><span class="o">.</span><span class="n">median_combine</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="flats-4-fig">
<a class="reference internal image-reference" href="../_images/p2_05_flats_4.png"><img alt="../_images/p2_05_flats_4.png" src="../_images/p2_05_flats_4.png" style="width: 800px;" /></a>
<p class="caption"><span class="caption-text">Se muestran un flat del filtro ancho donde aparece al imagen de una estrella y la combinación de  los flats donde desaparece esa estrella.</span><a class="headerlink" href="#flats-4-fig" title="Permalink to this image">¶</a></p>
</div>
<p>El master FLAT presenta una degradación del número de cuentas hacia los bordes que puede ser en parte debido a viñeteo. La corrección con estos FLATS permitirá corregir este efecto.</p>
<p>Antes de procesar las imágenes de ciencia vamos a comprobar que la rutina <code class="docutils literal notranslate"><span class="pre">ccdproc.flat_correct</span></code> divide por un FLAT normalizado. Si no fuere así tendríamos que normalizar el master FLAT. La división por una imagen con valores
cercanos a la unidad permite mantener el nivel aproximado de cuentas que es muy útil para calcular la relación señal ruido. Usamos la imagen 102</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filelist</span><span class="p">[</span><span class="mi">102</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">],</span><span class="s1">&#39;  filter: &#39;</span><span class="p">,</span><span class="n">image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;ALFLTID&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<pre>
GC4496A R 3x300s   filter:  76
</pre>
<p>y la procesamos para corregir de FLAT</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_image</span> <span class="o">=</span> <span class="n">ccdproc</span><span class="o">.</span><span class="n">flat_correct</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">master_flat_76</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Si las mostramos juntas comprobamos que tienen niveles parecidos.</p>
<div class="figure align-default" id="flats-5-fig">
<a class="reference internal image-reference" href="../_images/p2_05_flats_5.png"><img alt="../_images/p2_05_flats_5.png" src="../_images/p2_05_flats_5.png" style="width: 800px;" /></a>
<p class="caption"><span class="caption-text">Se muestran una imagen de ciencia y la misma una vez corre¡gida de FLAT.</span><a class="headerlink" href="#flats-5-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="flats-6-fig">
<a class="reference internal image-reference" href="../_images/p2_05_flats_6.png"><img alt="../_images/p2_05_flats_6.png" src="../_images/p2_05_flats_6.png" style="width: 800px;" /></a>
<p class="caption"><span class="caption-text">Detalle en la esquina inferior izquierda de las imágenes de la figura anterior.</span><a class="headerlink" href="#flats-6-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="flats-7-fig">
<a class="reference internal image-reference" href="../_images/p2_05_flats_7.png"><img alt="../_images/p2_05_flats_7.png" src="../_images/p2_05_flats_7.png" style="width: 800px;" /></a>
<p class="caption"><span class="caption-text">Los tres master FLAT correspondientes a los tres filtros empleados en al noche 1.</span><a class="headerlink" href="#flats-7-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="flats-8-fig">
<a class="reference internal image-reference" href="../_images/p2_05_flats_8.png"><img alt="../_images/p2_05_flats_8.png" src="../_images/p2_05_flats_8.png" style="width: 800px;" /></a>
<p class="caption"><span class="caption-text">Los tres master FLAT correspondientes a los tres filtros empleados en al noche 1 mostrados en DS9 con otra tabla de color.</span><a class="headerlink" href="#flats-8-fig" title="Permalink to this image">¶</a></p>
</div>
<p>Finalmente, para los tres master FLAT,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">master_flat_49</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">image_flats_49</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">master_flat_49</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;super FLAT combining &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_flats_49</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; FLATS images&#39;</span>
<span class="n">master_flat_49</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>  <span class="o">=</span>  <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())[</span><span class="mi">0</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; astropy median combine&#39;</span>
<span class="n">master_flat_49</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;FLATS images from &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_flats_49</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">image_flats_49</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">])</span>

<span class="n">master_flat_49</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;N1_master_flat_49&#39;</span> 

<span class="n">master_flat_49</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="s1">&#39;flat_N1_49.fits&#39;</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="corrigiendo-de-variacion-espacial-de-sensibilidad">
<h3>Corrigiendo de variación espacial de sensibilidad<a class="headerlink" href="#corrigiendo-de-variacion-espacial-de-sensibilidad" title="Permalink to this headline">¶</a></h3>
<p>Ya estamos preparados para corregir de Flat Field (‘Flat Fielding’) todas las imágenes que interesen. Recordemos que debemos aplicar el Flat Field correspondiente a cada filtro. Entonces la primera tarea es hacer una lista con las imágenes que queremos procesar en este paso. No tiene sentido corregir BIAS o FLATs de Flat Field, por ejemplo.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ccdproc</span> <span class="kn">import</span> <span class="n">ImageFileCollection</span>
<span class="kn">from</span> <span class="nn">ccdproc.utils.sample_directory</span> <span class="kn">import</span> <span class="n">sample_directory_with_files</span>

<span class="n">directory</span><span class="o">=</span><span class="s1">&#39;/Users/jzamorano/Desktop/NOT_2008/N1/&#39;</span>   <span class="c1"># change the path to your working directory</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span> <span class="p">,</span> <span class="s1">&#39;EXPTIME&#39;</span> <span class="p">,</span> <span class="s1">&#39;ALFLTID&#39;</span> <span class="p">,</span> <span class="s1">&#39;FAFLTID&#39;</span> <span class="p">,</span> <span class="s1">&#39;FBFLTID&#39;</span><span class="p">]</span>
<span class="n">ic1</span> <span class="o">=</span> <span class="n">ImageFileCollection</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">keywords</span><span class="o">=</span><span class="n">keys</span><span class="p">)</span> <span class="c1"># only keep track of keys</span>
<span class="n">ic1</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">colnames</span>
</pre></div>
</div>
</div>
</div>
<p>Seleccionamos todas las imágenes obtenidas con el filtro con id=78</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">matches</span> <span class="o">=</span> <span class="p">(</span><span class="n">ic1</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;FBFLTID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">78</span><span class="p">)</span>
<span class="n">sci_list_78</span> <span class="o">=</span> <span class="n">ic1</span><span class="o">.</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">][</span><span class="n">matches</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sci_list_78</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="pre-file-br-flat-n1-78-fits-zt-alrd120021-fits-zt-alrd120023-fits-zt-alrd120024-fits">
<h2><pre>
file<br />
flat_N1_78.fits
zt_ALrd120021.fits
zt_ALrd120023.fits
zt_ALrd120024.fits<a class="headerlink" href="#pre-file-br-flat-n1-78-fits-zt-alrd120021-fits-zt-alrd120023-fits-zt-alrd120024-fits" title="Permalink to this headline">¶</a></h2>
<p>zt_ALrd120119.fits
zt_ALrd120120.fits
zt_ALrd120121.fits
zt_ALrd120122.fits
Length = 36 rows
</pre></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sci_images_78</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">sci_list_78</span><span class="p">:</span>
    <span class="n">sci_images_78</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="n">file</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Y listamos la información de algunos descriptores</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filename          Object        exp Mean std min  max&#39;</span><span class="p">)</span>
<span class="n">exposure</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sci_list_78</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">sci_images_78</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">],</span> 
          <span class="n">sci_images_78</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;OBJECT&#39;</span><span class="p">],</span> 
          <span class="n">sci_images_78</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;EXPTIME&#39;</span><span class="p">],</span> 
          <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sci_images_78</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span> 
          <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">sci_images_78</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span> 
          <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sci_images_78</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> 
          <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sci_images_78</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<pre>
Filename            Object            exp Mean  std  min  max
0 N1_master_flat_78  Sky Flat evening 0.1 22789 8116 32.5 32932.0
1 zt_ALrd120021.fits Dome Flat NB#78 10.0 6753 2509 -8.5 16666.0
2 zt_ALrd120023.fits Dome Flat NB#78 30.0 20303 7538 11.5 29560.5
3 zt_ALrd120024.fits Dome Flat NB#78 30.0 20363 7560 11.5 29627.0
4 zt_ALrd120025.fits Dome Flat NB#78 30.0 20356 7557 21.5 29766.0
5 zt_ALrd120026.fits Dome Flat NB#78 30.0 20313 7541 20.5 29711.0
6 zt_ALrd120027.fits Dome Flat NB#78 30.0 20242 7514 16.5 33439.5
7 zt_ALrd120028.fits Dome Flat NB#78 30.0 20229 7509 16.5 41590.0
8 zt_ALrd120029.fits Dome Flat NB#78 30.0 20227 7509 27.5 30235.5
9 zt_ALrd120030.fits Dome Flat NB#78 30.0 20333 7548 16.5 37827.5
10 zt_ALrd120031.fits Dome Flat NB#78 30.0 20320 7543 12.5 29711.5
11 zt_ALrd120032.fits Dome Flat NB#78 30.0 20320 7543 16.5 31909.0
12 zt_ALrd120044.fits Sky Flat evening 0.1 2693 962 -29.0 6723.0
13 zt_ALrd120045.fits Sky Flat evening 1.199 8912 3405 13.5 65182.0
14 zt_ALrd120046.fits Sky Flat evening 3.5 20878 7435 32.5 34683.5
15 zt_ALrd120047.fits Sky Flat evening 5.0 22790 8114 27.5 32932.0
16 zt_ALrd120048.fits Sky Flat evening 7.5 24451 8705 46.5 35316.0
17 zt_ALrd120049.fits Sky Flat evening 11.0 23964 8531 33.5 39714.0
18 zt_ALrd120050.fits Sky Flat evening 17.0 23630 8412 34.5 34251.5
19 zt_ALrd120067.fits HZ44 focusing 30.0 11 11 -44.5 9684.5
20 zt_ALrd120068.fits HZ44 focusing 30.0 11 12 -45.0 7712.5
21 zt_ALrd120073.fits HZ44 focusing 20.0 9 8 -37.0 3707.5
22 zt_ALrd120074.fits HZ44 focusing 20.0 9 8 -40.0 3870.0
23 zt_ALrd120079.fits HZ44 #79 50.0 10 26 -43.5 9088.5
24 zt_ALrd120083.fits BD+75d325 #78 30.0 12 80 -35.5 44488.0
25 zt_ALrd120087.fits Feige34 #78 40.0 9 27 -47.5 15274.5
26 zt_ALrd120098.fits C3982 #78 3x900s 900.0 140 74 -50.0 12259.5
27 zt_ALrd120099.fits C3982 #78 3x900s 900.0 339 131 -47.0 16072.5
28 zt_ALrd120100.fits C3982 #78 3x900s 900.0 204 93 -48.0 19197.0
29 zt_ALrd120113.fits C4941 #78 3x900s 900.0 119 223 -45.0 65179.5
30 zt_ALrd120114.fits C4941 #78 3x900s 900.0 116 186 -45.5 65179.5
31 zt_ALrd120115.fits C4941 #78 3x900s 900.0 77 196 -50.0 65181.5
32 zt_ALrd120119.fits C5363 #78 3x900s 900.0 50 159 -46.0 65179.0
33 zt_ALrd120120.fits C5363 #78 3x900s 900.0 49 157 -47.5 65179.5
34 zt_ALrd120121.fits C5363 #78 3x900s 900.0 52 162 -50.5 65180.0
35 zt_ALrd120122.fits C5363 #78 3x900s 180.0 11 31 -46.5 48333.0
</pre>
<p>Al imprimir colocando el número de orden me es más fácil seleccionar. Antes de sci_list_78[19] son imágenes de Flat Field y desde sci_list_78[26] en adelante son observaciones de un GRB (Gamma Ray Burst) que una alerta nos obligó a realizar y parar nuestro proyecto. Por lo tanto</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sci_list_78</span> <span class="o">=</span> <span class="n">sci_list_78</span><span class="p">[</span><span class="mi">19</span><span class="p">:</span><span class="mi">25</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sci_list_78</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="pre-file">
<h2><pre>
file<a class="headerlink" href="#pre-file" title="Permalink to this headline">¶</a></h2>
<p>zt_ALrd120067.fits
zt_ALrd120068.fits
zt_ALrd120073.fits
zt_ALrd120074.fits
zt_ALrd120079.fits
zt_ALrd120083.fits
</pre></p>
<p>Y ahora corregimos de Flat Field esas imágenes y las grabamos en nuestro directorio añadiéndole información de esta parte del procesado. En el nombre le añadimos una ‘f’.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">sci_list_78</span><span class="p">:</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">CCDData</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="n">file</span><span class="p">)</span>
    <span class="n">f_image</span> <span class="o">=</span> <span class="n">ccdproc</span><span class="o">.</span><span class="n">flat_correct</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="n">master_flat_78</span><span class="p">)</span>
    <span class="n">name_of_file</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">])</span>
    <span class="n">f_image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">name_of_file</span>
    <span class="n">f_image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())[</span><span class="mi">0</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39; astropy ccdproc flat_correct &#39;</span>
    <span class="n">f_image</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;HISTORY&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="s1">&#39;using NOT2008/N1/master_flat_78.fits master FLAT&#39;</span> 
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;writting &#39;</span><span class="o">+</span><span class="n">name_of_file</span><span class="o">+</span> <span class="s1">&#39; in &#39;</span><span class="o">+</span><span class="n">directory</span><span class="p">)</span>
    <span class="n">f_image</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">directory</span><span class="o">+</span><span class="n">name_of_file</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="flats-9-fig">
<a class="reference internal image-reference" href="../_images/p2_05_flats_9.png"><img alt="../_images/p2_05_flats_9.png" src="../_images/p2_05_flats_9.png" style="width: 500px;" /></a>
<p class="caption"><span class="caption-text">Las líneas del final de la cabecera de las imágenes corregidas tienen información del procesado hasta ahora.</span><a class="headerlink" href="#flats-9-fig" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="procesado-de-las-imagenes-de-estandares-de-flujo-y-cientificas">
<h3>Procesado de las imágenes de estándares de flujo y científicas<a class="headerlink" href="#procesado-de-las-imagenes-de-estandares-de-flujo-y-cientificas" title="Permalink to this headline">¶</a></h3>
<p>Sustracción de bias, corrección de flat field (aplicando a cada imagen el obtenido con el mismo filtro).</p>
</div>
<div class="section" id="eliminacion-de-rayos-cosmicos">
<h3>Eliminación de rayos cósmicos<a class="headerlink" href="#eliminacion-de-rayos-cosmicos" title="Permalink to this headline">¶</a></h3>
<p>mediante combinación de 3 o más imágenes similares (de existir), lo que precisa alineamiento previo, o limpieza individual mediante proceso semi-interactivo con el programa cleanest.</p>
</div>
<div class="section" id="calibracion-astrometrica">
<h3>Calibración astrométrica<a class="headerlink" href="#calibracion-astrometrica" title="Permalink to this headline">¶</a></h3>
<p>Para ello se utilizará <a class="reference external" href="http://astrometry.net/">Astrometry.net</a> y las herramientas disponibles en <span class="xref myst">AstrOmatic.net</span>.</p>
</div>
<div class="section" id="calibracion-fotometrica">
<h3>Calibración fotométrica<a class="headerlink" href="#calibracion-fotometrica" title="Permalink to this headline">¶</a></h3>
<p>Determinación de las constantes instrumentales y coeficientes de extinción para cada noche.</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By J.Zamorano, N. Cardiel, S. Pascual and J. Gallego<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>